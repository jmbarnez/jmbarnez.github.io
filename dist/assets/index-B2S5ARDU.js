var ye=Object.defineProperty;var ve=(t,e,n)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var $=(t,e,n)=>ve(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const Ee="modulepreload",Se=function(t){return"/"+t},le={},F=function(e,n,s){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(n.map(c=>{if(c=Se(c),c in le)return;le[c]=!0;const h=c.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":Ee,h||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((m,b)=>{f.addEventListener("load",m),f.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})},A=t=>document.getElementById(t),j=t=>document.querySelectorAll(t),q=(t,e,n)=>Math.max(e,Math.min(n,t)),be={BASE_URL:(()=>{if(typeof window<"u"){const t=window.location.hostname;return t.includes("ngrok-free.app")||t.includes("ngrok.app")?window.location.origin:t==="localhost"||t==="127.0.0.1"?"http://localhost:3002":`http://${t}:3002`}return"http://localhost:3002"})(),ENDPOINTS:{SAVE:"/api/save",AUTH:"/api/auth",CHAT:"/api/chat"},TIMEOUTS:{REQUEST:5e3,SAVE:1e4}},Te={AUTO_SAVE_INTERVAL:3e4,DEBOUNCE_DELAY:2e3,MAX_RETRIES:3,RETRY_DELAY:1e3},xe={XP:{BASE_XP_TO_NEXT:100,XP_MULTIPLIER:1.2,MAX_LEVEL:99},STATS:{STARTING_HP:100,STARTING_STAMINA:100,STARTING_MANA:100,HP_PER_LEVEL:5,STAMINA_PER_LEVEL:3,MANA_PER_LEVEL:4},INVENTORY:{DEFAULT_CAPACITY:25,MAX_CAPACITY:100,STACK_SIZE:1e3},EXPLORATION:{BASE_EXPLORE_TIME:3e3,DISCOVERY_CHANCE:.15,RARE_DISCOVERY_CHANCE:.05,XP_PER_EXPLORATION:10},FISHING:{BASE_CATCH_TIME:2e3,SUCCESS_CHANCE:.8,RARE_FISH_CHANCE:.1,XP_PER_CATCH:15},GROUND_ITEMS:{MAX_ITEMS:50,CLEANUP_THRESHOLD:40,DEFAULT_SPAWN_COUNT:1,MULTI_SPAWN_CHANCE:.2}},we={ANIMATIONS:{FADE_DURATION:300,SLIDE_DURATION:250,PULSE_DURATION:1e3,DISCOVERY_CARD_DURATION:500},PANELS:{DEFAULT_POSITIONS:{inventory:{x:20,y:100},equipment:{x:350,y:100},skills:{x:680,y:100},chat:{x:20,y:400},zones:{x:350,y:400}},MIN_WIDTH:200,MIN_HEIGHT:150,DRAG_THRESHOLD:5},NOTIFICATIONS:{DURATION:3e3,MAX_VISIBLE:5,FADE_OUT_DURATION:500}},Ae={DEFAULT_VOLUMES:{AMBIENCE:.08,SFX:.15,MASTER:1},FADE_DURATION:500,MAX_SIMULTANEOUS_SFX:5},Ie={ICONS:{DEFAULT:"icon-shell",FALLBACK:"icon-shell",EQUIPMENT_FALLBACK:"icon-player"},EQUIPMENT_TYPES:["helmet","chest","gloves","pants","shoes","ring1","ring2","amulet"],RARITY:{COMMON:{weight:70,color:"#FFFFFF"},UNCOMMON:{weight:20,color:"#00FF00"},RARE:{weight:8,color:"#0080FF"},EPIC:{weight:2,color:"#8000FF"}}},K={ENABLED:!1,LOG_LEVELS:{ERROR:0,WARN:1,INFO:2,DEBUG:3},DEFAULT_LOG_LEVEL:2,PERFORMANCE_MONITORING:!0,SHOW_FPS:!1,ERROR_REPORTING:{ENABLED:!1,MAX_QUEUE_SIZE:100,REPORT_ENDPOINT:"/api/errors"}},Ce={ZONES:{beach:{name:"Serene Shores",icon:"🏖️",badgeClass:"beach",bgClass:"beach-vector",unlocked:!0,ambientSound:"beach-ambience.mp3"},forest:{name:"Whispering Woods",icon:"🌲",badgeClass:"forest",bgClass:"forest-vector",unlocked:!1,ambientSound:"tforest-ambience.mp3",unlockRequirement:{exploration:5}}}},T={API:be,SAVE:Te,BALANCE:xe,UI:we,AUDIO:Ae,ITEMS:Ie,DEBUG:K,LOCATIONS:Ce};let Le=class{constructor(){this.currentLevel=K.DEFAULT_LOG_LEVEL,this.setLevel(K.DEFAULT_LOG_LEVEL)}setLevel(e){this.currentLevel=e}shouldLog(e){return e==="error"}formatMessage(e,n,s){const o=`[${new Date().toLocaleTimeString()}] [${e.toUpperCase()}]`;return s?`${o} ${n}`:`${o} ${n}`}error(e,n){this.shouldLog("error")&&console.error(this.formatMessage("error",e),n||"")}warn(e,n){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",e),n||"")}info(e,n){this.shouldLog("info")&&console.log(this.formatMessage("info",e),n||"")}debug(e,n){this.shouldLog("debug")&&console.log(this.formatMessage("debug",e),n||"")}time(e){this.shouldLog("debug")&&console.time(e)}timeEnd(e){this.shouldLog("debug")&&console.timeEnd(e)}saveOperation(e,n){this.info(`[SAVE] ${e}`,n)}gameAction(e,n){this.debug(`[GAME] ${e}`,n)}apiCall(e,n,s){const i=s?` (${s})`:"";this.debug(`[API] ${n} ${e}${i}`)}};const x=new Le,r={stats:{hp:T.BALANCE.STATS.STARTING_HP,hpMax:T.BALANCE.STATS.STARTING_HP,stamina:T.BALANCE.STATS.STARTING_STAMINA,staminaMax:T.BALANCE.STATS.STARTING_STAMINA,mana:T.BALANCE.STATS.STARTING_MANA,manaMax:T.BALANCE.STATS.STARTING_MANA},fishing:{level:1,xp:0,xpToNext:T.BALANCE.XP.BASE_XP_TO_NEXT},exploration:{level:1,xp:0,xpToNext:T.BALANCE.XP.BASE_XP_TO_NEXT},combat:{attack:{level:1,xp:0,xpToNext:T.BALANCE.XP.BASE_XP_TO_NEXT},strength:{level:1,xp:0,xpToNext:T.BALANCE.XP.BASE_XP_TO_NEXT},defense:{level:1,xp:0,xpToNext:T.BALANCE.XP.BASE_XP_TO_NEXT}},foraging:{level:1,xp:0,xpToNext:T.BALANCE.XP.BASE_XP_TO_NEXT},inventory:[{name:"Leather Helmet",count:1,type:"helmet"},{name:"Leather Chest",count:1,type:"chest"},{name:"Leather Gloves",count:1,type:"gloves"},{name:"Leather Pants",count:1,type:"pants"},{name:"Leather Boots",count:1,type:"shoes"},{name:"Fishing Pole",count:1}],equipment:{helmet:null,chest:null,gloves:null,pants:null,shoes:null,ring1:null,ring2:null,amulet:null},invCapacity:T.BALANCE.INVENTORY.DEFAULT_CAPACITY,coins:0,isFishing:!1,isExploring:!1,discoveredFishingSpot:!1,activeView:"explore",discoveries:[]},V={current:{key:"beach",name:T.LOCATIONS.ZONES.beach.name,icon:T.LOCATIONS.ZONES.beach.icon},all:{beach:{key:"beach",name:T.LOCATIONS.ZONES.beach.name,icon:T.LOCATIONS.ZONES.beach.icon,badgeClass:T.LOCATIONS.ZONES.beach.badgeClass,bgClass:T.LOCATIONS.ZONES.beach.bgClass},forest:{key:"forest",name:T.LOCATIONS.ZONES.forest.name,icon:T.LOCATIONS.ZONES.forest.icon,badgeClass:T.LOCATIONS.ZONES.forest.badgeClass,bgClass:T.LOCATIONS.ZONES.forest.bgClass}}};function ke(){const t={gameState:{...r},gameTheme:localStorage.getItem("gameTheme")||"light",fishDiscovered:JSON.parse(localStorage.getItem("fish_discovered")||"[]"),panelPositions:{},zonePositions:{},groundItems:r.discoveries||[],idleState:null,_savedAt:new Date().toISOString()};for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);if(n!=null&&n.startsWith("panel-pos:"))try{const s=n.replace("panel-pos:","");t.panelPositions[s]=JSON.parse(localStorage.getItem(n)||"{}")}catch{}}for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);if(n!=null&&n.startsWith("zone_pos_"))try{const s=n.replace("zone_pos_","");t.zonePositions[s]=JSON.parse(localStorage.getItem(n)||"{}")}catch{}}try{const e=localStorage.getItem("sandboxIdleState");e&&(t.idleState=JSON.parse(e))}catch{}return t}function Be(t){try{t.gameState&&Object.assign(r,t.gameState),t.gameTheme&&localStorage.setItem("gameTheme",t.gameTheme),t.fishDiscovered&&localStorage.setItem("fish_discovered",JSON.stringify(t.fishDiscovered)),t.panelPositions&&Object.entries(t.panelPositions).forEach(([e,n])=>{localStorage.setItem(`panel-pos:${e}`,JSON.stringify(n))}),t.zonePositions&&Object.entries(t.zonePositions).forEach(([e,n])=>{localStorage.setItem(`zone_pos_${e}`,JSON.stringify(n))}),t.idleState&&localStorage.setItem("sandboxIdleState",JSON.stringify(t.idleState)),t.groundItems&&Array.isArray(t.groundItems)&&(r.discoveries=t.groundItems),x.saveOperation("Complete game data restored successfully")}catch(e){x.error("Failed to restore some game data",e)}}async function Ne(){try{const t=localStorage.getItem("authToken");if(!t)return x.info("No auth token, using default state"),!1;x.apiCall(T.API.ENDPOINTS.SAVE,"GET");const e=await fetch(`${T.API.BASE_URL}${T.API.ENDPOINTS.SAVE}`,{headers:{Authorization:`Bearer ${t}`}});if(e.ok){const n=await e.json();if(n!=null&&n.save)return Be(n.save),x.saveOperation("Complete game state loaded from server successfully"),!0}return x.info("No saved data found on server, using default state"),!1}catch(t){return x.error("Failed to load saved state from server",t),!1}}async function te(){try{const t=localStorage.getItem("authToken");if(!t)return x.warn("No auth token, cannot save to server"),!1;const e=ke();x.apiCall(T.API.ENDPOINTS.SAVE,"POST");const n=await fetch(`${T.API.BASE_URL}${T.API.ENDPOINTS.SAVE}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({save:e})});return n.ok?(x.saveOperation("Complete game state saved to server successfully"),!0):(x.warn(`Failed to save to server: ${n.status}`),!1)}catch(t){return x.error("Failed to save complete game state to server",t),!1}}const v={context:null,ambientGain:null,ambientSources:[],ambientVolume:.08,ambientEnabled:!0,sfxGain:null,masterGain:null,walkingSources:[],isWalking:!1,beachAudio:null,audioFiles:{beachAmbience:null},useSampleSfx:!1,noiseBuffer:null,footstepIntervalId:null,windIntervalId:null,walkingPanDir:1,useSampleSfx:!1,noiseBuffer:null,uiClickAudio:null,uiClickVolume:.18,uiClickLoading:!1,uiHoverAudio:null,uiHoverVolume:.16,uiHoverLoading:!1,goldPickupAudio:null,goldPickupVolume:.22,goldPickupLoading:!1,pickupCache:new Map,pickupVolume:.2,ensureContext(){this.context||(this.context=new(window.AudioContext||window.webkitAudioContext));try{this.context.state==="suspended"&&this.context.resume()}catch{}return this.context},async startAmbientSounds(){var e,n;if(!this.ambientEnabled)return;const t=this.ensureContext();if(t)try{this.masterGain||(this.masterGain=t.createGain(),this.masterGain.gain.setValueAtTime(1,t.currentTime),this.masterGain.connect(t.destination)),this.ambientGain=this.ambientGain||t.createGain(),this.ambientGain.gain.setValueAtTime(this.ambientVolume,t.currentTime),(n=(e=this.ambientGain).disconnect)==null||n.call(e),this.ambientGain.connect(this.masterGain),this.sfxGain||(this.sfxGain=t.createGain(),this.sfxGain.gain.setValueAtTime(.15,t.currentTime),this.sfxGain.connect(this.masterGain)),await this.loadBeachAudio()&&this.playBeachAudio()}catch(s){console.warn("Ambient audio setup failed:",s)}},async loadUIClickSound(t){const e=t?[t]:["assets/btn-click.wav","./assets/btn-click.wav","assets/btn-click.mp3","./assets/btn-click.mp3","assets/btn-click.ogg","./assets/btn-click.ogg","assets/ui-click.wav","./assets/ui-click.wav","assets/ui-click.mp3","./assets/ui-click.mp3","assets/ui-click.ogg","./assets/ui-click.ogg"];for(const n of e)try{const s=new Audio(n);return s.volume=this.uiClickVolume,await new Promise((i,o)=>{const a=setTimeout(()=>o(new Error("UI click load timeout")),8e3);s.addEventListener("canplaythrough",()=>{clearTimeout(a),i()},{once:!0}),s.addEventListener("error",()=>{clearTimeout(a),o(new Error("audio error"))},{once:!0}),s.load()}),this.uiClickAudio=s,!0}catch{this.uiClickAudio=null;continue}return!1},setUIClickVolume(t){this.uiClickVolume=q(t,0,1),this.uiClickAudio&&(this.uiClickAudio.volume=this.uiClickVolume)},setUIClickSound(t){return this.loadUIClickSound(t)},async setUIClickFromFile(t){try{const e=URL.createObjectURL(t),n=await this.loadUIClickSound(e);return n||URL.revokeObjectURL(e),n}catch{return!1}},async loadBeachAudio(){const t=["assets/beach-ambience.mp3","./assets/beach-ambience.mp3","beach-ambience.mp3","./beach-ambience.mp3","assets/forest-ambience.mp3","./assets/forest-ambience.mp3"];for(const e of t)try{try{const n=await fetch(e,{method:"HEAD"});if(!n.ok)throw new Error(`HTTP ${n.status}`)}catch{continue}return this.beachAudio=new Audio(e),this.beachAudio.loop=!0,this.beachAudio.volume=0,await new Promise((n,s)=>{const i=setTimeout(()=>s(new Error("Loading timeout after 10 seconds")),1e4);this.beachAudio.addEventListener("canplaythrough",()=>{clearTimeout(i),n()},{once:!0}),this.beachAudio.addEventListener("error",()=>{clearTimeout(i),s(new Error("audio error"))},{once:!0}),this.beachAudio.load()}),!0}catch{this.beachAudio=null;continue}return!1},playBeachAudio(){if(!this.beachAudio||!this.ambientEnabled)return;const t=this.beachAudio.play();t!==void 0&&t.then(()=>this.fadeInAudio()).catch(()=>{}),this.ambientSources.push({source:this.beachAudio})},fadeInAudio(){if(!this.beachAudio)return;const t=this.ambientVolume,e=30,n=100;let s=0;const i=setInterval(()=>{s++;const o=s/e*t;this.beachAudio.volume=Math.min(o,t),s>=e&&clearInterval(i)},n)},createWaveSound(){},createSeagullSound(){},createWindSound(){},startWalkingSounds(){try{this.stopWalkingSounds()}catch{}const t=this.ensureContext();t&&(this.masterGain||(this.masterGain=t.createGain(),this.masterGain.gain.setValueAtTime(1,t.currentTime),this.masterGain.connect(t.destination)),this.ambientGain||(this.ambientGain=t.createGain(),this.ambientGain.gain.setValueAtTime(this.ambientVolume,t.currentTime),this.ambientGain.connect(this.masterGain)),this.windIntervalId=setInterval(()=>{const e=.015+Math.random()*.02;this.playNoiseBurst({durationMs:300,gain:e,filterType:"lowpass",filterFreq:900,pan:0,toAmbient:!0})},3e3))},stopWalkingSounds(){this.footstepIntervalId&&(clearInterval(this.footstepIntervalId),this.footstepIntervalId=null),this.windIntervalId&&(clearInterval(this.windIntervalId),this.windIntervalId=null)},stopAmbientSounds(){this.beachAudio&&(this.beachAudio.pause(),this.beachAudio.currentTime=0),this.ambientSources.forEach(({source:t})=>{try{t&&t.stop&&t.stop(),t&&t.pause&&t.pause()}catch{}}),this.ambientSources=[],this.ambientGain&&(this.ambientGain.disconnect(),this.ambientGain=null)},setAmbientVolume(t){this.ambientVolume=q(t,0,1),this.beachAudio&&(this.beachAudio.volume=this.ambientVolume),this.ambientGain&&this.context&&this.ambientGain.gain.setValueAtTime(this.ambientVolume,this.context.currentTime)},toggleAmbientSounds(){this.ambientEnabled=!this.ambientEnabled,this.ambientEnabled?this.startAmbientSounds():this.stopAmbientSounds()},playTone({frequency:t=440,durationMs:e=120,type:n="sine",gain:s=.15}){const i=this.ensureContext();if(!i)return;this.masterGain||(this.masterGain=i.createGain(),this.masterGain.gain.setValueAtTime(1,i.currentTime),this.masterGain.connect(i.destination)),this.sfxGain||(this.sfxGain=i.createGain(),this.sfxGain.gain.setValueAtTime(.15,i.currentTime),this.sfxGain.connect(this.masterGain));const o=i.createOscillator(),a=i.createGain();o.type=n,o.frequency.setValueAtTime(t,i.currentTime),a.gain.setValueAtTime(0,i.currentTime),a.gain.linearRampToValueAtTime(s,i.currentTime+.01),a.gain.exponentialRampToValueAtTime(.001,i.currentTime+e/1e3),o.connect(a),a.connect(this.sfxGain),o.start(),o.stop(i.currentTime+e/1e3+.02)},playSweep({startFreq:t=1200,endFreq:e=400,durationMs:n=120,type:s="square",gain:i=.15}){const o=this.ensureContext();if(!o)return;this.masterGain||(this.masterGain=o.createGain(),this.masterGain.gain.setValueAtTime(1,o.currentTime),this.masterGain.connect(o.destination)),this.sfxGain||(this.sfxGain=o.createGain(),this.sfxGain.gain.setValueAtTime(.15,o.currentTime),this.sfxGain.connect(this.masterGain));const a=o.createOscillator(),l=o.createGain();a.type=s,a.frequency.setValueAtTime(Math.max(1,t),o.currentTime),a.frequency.exponentialRampToValueAtTime(Math.max(1,e),o.currentTime+n/1e3),l.gain.setValueAtTime(0,o.currentTime),l.gain.linearRampToValueAtTime(i,o.currentTime+.01),l.gain.exponentialRampToValueAtTime(.001,o.currentTime+n/1e3),a.connect(l),l.connect(this.sfxGain),a.start(),a.stop(o.currentTime+n/1e3+.02)},ensureNoiseBuffer(){if(this.noiseBuffer)return this.noiseBuffer;const t=this.ensureContext();if(!t)return null;const e=Math.max(1,Math.floor(.5*t.sampleRate)),n=t.createBuffer(1,e,t.sampleRate),s=n.getChannelData(0);for(let i=0;i<e;i++)s[i]=(Math.random()*2-1)*.7;return this.noiseBuffer=n,n},playNoiseBurst({durationMs:t=80,gain:e=.06,filterType:n="highpass",filterFreq:s=1800,pan:i=0,toAmbient:o=!1}){const a=this.ensureContext();if(!a)return;this.masterGain||(this.masterGain=a.createGain(),this.masterGain.gain.setValueAtTime(1,a.currentTime),this.masterGain.connect(a.destination));const l=o?this.ambientGain||this.masterGain:this.sfxGain||(this.sfxGain=a.createGain(),this.sfxGain.gain.setValueAtTime(.15,a.currentTime),this.sfxGain.connect(this.masterGain),this.sfxGain),c=a.createBufferSource();c.buffer=this.ensureNoiseBuffer();const h=a.createBiquadFilter();h.type=n,h.frequency.setValueAtTime(s,a.currentTime);const p=a.createGain();p.gain.setValueAtTime(e,a.currentTime);let f=p;try{const m=a.createStereoPanner();m.pan.setValueAtTime(i,a.currentTime),f=m,p.connect(m),f.connect(l)}catch{p.connect(l)}c.connect(h),h.connect(p),c.start(),c.stop(a.currentTime+t/1e3)},playSweep({startFreq:t=800,endFreq:e=300,durationMs:n=120,type:s="square",gain:i=.15}){const o=this.ensureContext();if(!o)return;this.masterGain||(this.masterGain=o.createGain(),this.masterGain.gain.setValueAtTime(1,o.currentTime),this.masterGain.connect(o.destination)),this.sfxGain||(this.sfxGain=o.createGain(),this.sfxGain.gain.setValueAtTime(.15,o.currentTime),this.sfxGain.connect(this.masterGain));const a=o.createOscillator(),l=o.createGain();a.type=s,a.frequency.setValueAtTime(Math.max(1,t),o.currentTime),a.frequency.exponentialRampToValueAtTime(Math.max(1,e),o.currentTime+n/1e3),l.gain.setValueAtTime(0,o.currentTime),l.gain.linearRampToValueAtTime(i,o.currentTime+.01),l.gain.exponentialRampToValueAtTime(.001,o.currentTime+n/1e3),a.connect(l),l.connect(this.sfxGain),a.start(),a.stop(o.currentTime+n/1e3+.02)},ensureNoiseBuffer(){if(this.noiseBuffer)return this.noiseBuffer;const t=this.ensureContext();if(!t)return null;const e=Math.max(1,Math.floor(.5*t.sampleRate)),n=t.createBuffer(1,e,t.sampleRate),s=n.getChannelData(0);for(let i=0;i<e;i++)s[i]=(Math.random()*2-1)*.7;return this.noiseBuffer=n,n},playNoise({durationMs:t=120,gain:e=.05,filterType:n="highpass",filterFreq:s=1200}){const i=this.ensureContext();if(!i)return;this.masterGain||(this.masterGain=i.createGain(),this.masterGain.gain.setValueAtTime(1,i.currentTime),this.masterGain.connect(i.destination)),this.sfxGain||(this.sfxGain=i.createGain(),this.sfxGain.gain.setValueAtTime(.15,i.currentTime),this.sfxGain.connect(this.masterGain));const o=i.createBufferSource();o.buffer=this.ensureNoiseBuffer();const a=i.createBiquadFilter();a.type=n,a.frequency.setValueAtTime(s,i.currentTime);const l=i.createGain();l.gain.setValueAtTime(e,i.currentTime),o.connect(a),a.connect(l),l.connect(this.sfxGain),o.start(),o.stop(i.currentTime+t/1e3)},playClick(){this.playUIClick()},playUIClick(){if(this.useSampleSfx&&this.uiClickAudio)try{const t=this.uiClickAudio.cloneNode(!0);t.volume=this.uiClickVolume,t.play();return}catch{}this.playNoiseBurst({durationMs:40,gain:.05,filterType:"highpass",filterFreq:2400}),this.playTone({frequency:1500,durationMs:70,type:"square",gain:.14})},setSfxVolume(t){const e=q(t,0,1);this.sfxGain&&this.context&&this.sfxGain.gain.setValueAtTime(e,this.context.currentTime),this.uiClickVolume=e,this.uiHoverVolume=e*.9,this.goldPickupVolume=Math.min(1,e*1.1)},setMasterVolume(t){const e=q(t,0,1),n=this.ensureContext();if(!this.masterGain&&n){if(this.masterGain=n.createGain(),this.masterGain.gain.setValueAtTime(1,n.currentTime),this.masterGain.connect(n.destination),this.ambientGain){try{this.ambientGain.disconnect()}catch{}this.ambientGain.connect(this.masterGain)}if(this.sfxGain){try{this.sfxGain.disconnect()}catch{}this.sfxGain.connect(this.masterGain)}}this.masterGain&&this.context&&this.masterGain.gain.setValueAtTime(e,this.context.currentTime)},async loadUIHoverSound(t){const e=t?[t]:["assets/btn-hover.wav","./assets/btn-hover.wav","assets/btn-hover.mp3","./assets/btn-hover.mp3","assets/btn-hover.ogg","./assets/btn-hover.ogg"];for(const n of e)try{const s=new Audio(n);return s.volume=this.uiHoverVolume,await new Promise((i,o)=>{const a=setTimeout(()=>o(new Error("UI hover load timeout")),8e3);s.addEventListener("canplaythrough",()=>{clearTimeout(a),i()},{once:!0}),s.addEventListener("error",()=>{clearTimeout(a),o(new Error("audio error"))},{once:!0}),s.load()}),this.uiHoverAudio=s,!0}catch{this.uiHoverAudio=null;continue}return!1},setUIHoverVolume(t){this.uiHoverVolume=q(t,0,1),this.uiHoverAudio&&(this.uiHoverAudio.volume=this.uiHoverVolume)},setUIHoverSound(t){return this.loadUIHoverSound(t)},playButtonHover(){if(this.useSampleSfx&&this.uiHoverAudio)try{const t=this.uiHoverAudio.cloneNode(!0);t.volume=this.uiHoverVolume,t.play();return}catch{}this.playNoiseBurst({durationMs:30,gain:.035,filterType:"highpass",filterFreq:2600}),this.playTone({frequency:1150,durationMs:55,type:"triangle",gain:.1})},playButtonClick(){this.playUIClick()},playClickDeep(){this.playUIClick()},playClickSoft(){this.playUIClick()},playClickHi(){this.playUIClick()},playTab(){this.playNoiseBurst({durationMs:30,gain:.035,filterType:"highpass",filterFreq:2500}),this.playTone({frequency:1300,durationMs:60,type:"triangle",gain:.12})},playConfirm(){this.playSweep({startFreq:700,endFreq:1400,durationMs:120,type:"triangle",gain:.14}),this.playNoiseBurst({durationMs:40,gain:.03,filterType:"highpass",filterFreq:2500})},playCancel(){this.playSweep({startFreq:400,endFreq:220,durationMs:110,type:"sawtooth",gain:.12}),this.playNoiseBurst({durationMs:35,gain:.03,filterType:"highpass",filterFreq:2200})},playPickup(){this.playNoiseBurst({durationMs:35,gain:.035,filterType:"highpass",filterFreq:2300}),this.playTone({frequency:900,durationMs:70,type:"square",gain:.12})},playDrop(){this.playNoiseBurst({durationMs:45,gain:.045,filterType:"highpass",filterFreq:2e3}),this.playSweep({startFreq:500,endFreq:180,durationMs:150,type:"sawtooth",gain:.12})},playDelete(){this.playNoiseBurst({durationMs:40,gain:.045,filterType:"highpass",filterFreq:2300}),this.playTone({frequency:300,durationMs:70,type:"sine",gain:.12}),setTimeout(()=>this.playTone({frequency:240,durationMs:90,type:"sine",gain:.1}),60)},playEquip(){this.playNoiseBurst({durationMs:30,gain:.03,filterType:"highpass",filterFreq:2600}),this.playTone({frequency:900,durationMs:70,type:"triangle",gain:.12}),setTimeout(()=>this.playTone({frequency:1200,durationMs:70,type:"triangle",gain:.12}),60),setTimeout(()=>this.playTone({frequency:1500,durationMs:90,type:"triangle",gain:.12}),120)},playSoftBag(){(this.ensureContext()||{}).currentTime!=null&&(this.playTone({frequency:700,durationMs:70,type:"square",gain:.12}),setTimeout(()=>this.playTone({frequency:950,durationMs:70,type:"square",gain:.1}),70))},async loadGoldPickupSound(t){const e=t?[t]:["assets/gold-pickup.wav","./assets/gold-pickup.wav","assets/gold-pickup.mp3","./assets/gold-pickup.mp3","assets/gold-pickup.ogg","./assets/gold-pickup.ogg"];for(const n of e)try{const s=new Audio(n);return s.volume=this.goldPickupVolume,await new Promise((i,o)=>{const a=setTimeout(()=>o(new Error("gold pickup load timeout")),8e3);s.addEventListener("canplaythrough",()=>{clearTimeout(a),i()},{once:!0}),s.addEventListener("error",()=>{clearTimeout(a),o(new Error("audio error"))},{once:!0}),s.load()}),this.goldPickupAudio=s,!0}catch{this.goldPickupAudio=null;continue}return!1},setGoldPickupVolume(t){this.goldPickupVolume=q(t,0,1),this.goldPickupAudio&&(this.goldPickupAudio.volume=this.goldPickupVolume)},setGoldPickupSound(t){return this.loadGoldPickupSound(t)},playGoldPickup(){if(this.useSampleSfx&&this.goldPickupAudio)try{const t=this.goldPickupAudio.cloneNode(!0);t.volume=this.goldPickupVolume,t.play();return}catch{}this.playTone({frequency:1200,durationMs:60,type:"triangle",gain:.18}),setTimeout(()=>this.playTone({frequency:1600,durationMs:60,type:"triangle",gain:.18}),60),setTimeout(()=>this.playTone({frequency:2e3,durationMs:80,type:"triangle",gain:.18}),120),setTimeout(()=>this.playTone({frequency:2600,durationMs:90,type:"sine",gain:.16}),180)},async loadPickupSoundForKey(t,e){const n=e?[e]:[`assets/pickup-${t}.wav`,`./assets/pickup-${t}.wav`,`assets/pickup-${t}.mp3`,`./assets/pickup-${t}.mp3`,`assets/pickup-${t}.ogg`,`./assets/pickup-${t}.ogg`];for(const s of n)try{const i=new Audio(s);return i.volume=this.pickupVolume,await new Promise((o,a)=>{const l=setTimeout(()=>a(new Error("pickup load timeout")),8e3);i.addEventListener("canplaythrough",()=>{clearTimeout(l),o()},{once:!0}),i.addEventListener("error",()=>{clearTimeout(l),a(new Error("audio error"))},{once:!0}),i.load()}),this.pickupCache.set(t,{audio:i,volume:this.pickupVolume}),!0}catch{continue}return!1},setPickupVolume(t){this.pickupVolume=q(t,0,1),this.pickupCache.forEach(e=>{e&&e.audio&&(e.audio.volume=this.pickupVolume)})},setPickupSound(t,e){return this.loadPickupSoundForKey(t,e)},playPickupKey(t){if(this.useSampleSfx)try{const n=this.pickupCache.get(t);if(n&&n.audio){const s=n.audio.cloneNode(!0);s.volume=this.pickupVolume,s.play();return}this.loadPickupSoundForKey(t).catch(()=>{})}catch{}const e=String(t||"").toLowerCase();if(e==="wood"){this.playNoise({durationMs:80,gain:.06,filterType:"lowpass",filterFreq:900}),setTimeout(()=>this.playTone({frequency:320,durationMs:60,type:"square",gain:.1}),20);return}if(e==="shell"){this.playTone({frequency:1e3,durationMs:70,type:"sine",gain:.14}),setTimeout(()=>this.playTone({frequency:1500,durationMs:90,type:"triangle",gain:.12}),60);return}if(e==="seaweed"){this.playNoise({durationMs:90,gain:.05,filterType:"bandpass",filterFreq:1400});return}if(e==="location"){this.playSweep({startFreq:500,endFreq:1500,durationMs:180,type:"triangle",gain:.12});return}if(e==="fish"){this.playTone({frequency:900,durationMs:70,type:"square",gain:.12}),setTimeout(()=>this.playTone({frequency:600,durationMs:70,type:"square",gain:.1}),60);return}this.playTone({frequency:800,durationMs:80,type:"square",gain:.12})},playPickupFor({name:t="",category:e="",subtype:n=""}={}){const s=String(t||"").toLowerCase();if(e==="treasure"||s.includes("coin")){this.playGoldPickup();return}if(n==="fishing_spot"){this.playPickupKey("fish");return}if(s.includes("wood")||s.includes("drift")){this.playPickupKey("wood");return}if(s.includes("shell")){this.playPickupKey("shell");return}if(s.includes("weed")||s.includes("seaweed")){this.playPickupKey("seaweed");return}if(e==="location"){this.playPickupKey("location");return}this.playPickupKey("default")}},Me=3,ee={"Sea Shell":{icon:"icon-shell",stack:99,value:1,category:"loot"},Driftwood:{icon:"icon-driftwood",stack:99,value:1,category:"material"},Seaweed:{icon:"icon-seaweed",stack:99,value:1,category:"food"},"Small Coin":{icon:"icon-coin",stack:9999,value:1,category:"currency"},"Fishing Pole":{icon:"icon-hook",stack:1,value:10,category:"tool"}},ce={beach:[{name:"Sea Shell",category:"ground",rarity:40,xp:3,icon:"icon-shell",description:"A common seashell washed ashore"},{name:"Driftwood",category:"ground",rarity:35,xp:3,icon:"icon-driftwood",description:"A piece of smoothed driftwood"},{name:"Seaweed",category:"ground",rarity:30,xp:2,icon:"icon-seaweed",description:"Fresh seaweed tangled in the tide"},{name:"Small Coin",category:"ground",rarity:14,xp:3,icon:"icon-coin",description:"A weathered coin glinting in the sand"},{name:"Treasure Chest",category:"treasure",rarity:3,xp:12,icon:"icon-treasure-chest",description:"A chest half-buried in sand"},{name:"Whispering Woods",category:"location",unlockLocationKey:"forest",minLevel:5,rarity:2,xp:10,icon:"icon-location",description:"You sense a path into the woods..."}]},N={element:null,create(){return this.element||(this.element=document.createElement("div"),this.element.className="tooltip",document.body.appendChild(this.element)),this.element},show(t,e){const n=this.create();n.classList.remove("visible"),e.includes(`
`)?n.innerHTML=e.split(`
`).map(s=>s?`<div>${s}</div>`:'<div style="height: 8px;"></div>').join(""):n.textContent=e,n.style.left=t.pageX+10+"px",n.style.top=t.pageY-10+"px",n.classList.add("visible")},hide(){this.element&&(this.element.classList.remove("visible"),this.element.style.left="-9999px",this.element.style.top="-9999px")},move(t){this.element&&this.element.classList.contains("visible")&&(this.element.style.left=t.pageX+"px",this.element.style.top=t.pageY+"px")}};(()=>{if(typeof window<"u"){const t=window.location.hostname;return t.includes("ngrok-free.app")||t.includes("ngrok.app")?window.location.origin:t==="localhost"||t==="127.0.0.1"?"http://localhost:3002":`http://${t}:3002`}return"http://localhost:3002"})();const Pe={DEBOUNCE_DELAY:2e3},_e={XP:{BASE_XP_TO_NEXT:100,XP_MULTIPLIER:1.2,MAX_LEVEL:99},STATS:{STARTING_HP:100,STARTING_STAMINA:100,STARTING_MANA:100,HP_PER_LEVEL:5,STAMINA_PER_LEVEL:3,MANA_PER_LEVEL:4},INVENTORY:{DEFAULT_CAPACITY:25,MAX_CAPACITY:100,STACK_SIZE:1e3},EXPLORATION:{BASE_EXPLORE_TIME:3e3,DISCOVERY_CHANCE:.15,RARE_DISCOVERY_CHANCE:.05,XP_PER_EXPLORATION:10},FISHING:{BASE_CATCH_TIME:2e3,SUCCESS_CHANCE:.8,RARE_FISH_CHANCE:.1,XP_PER_CATCH:15},GROUND_ITEMS:{MAX_ITEMS:50,CLEANUP_THRESHOLD:40,DEFAULT_SPAWN_COUNT:1,MULTI_SPAWN_CHANCE:.2}};function qe(){const t=[];return Object.entries(_e).forEach(([e,n])=>{Object.entries(n).forEach(([s,i])=>{s.includes("CHANCE")&&(i<0||i>1)&&t.push(`${e}.${s} must be between 0 and 1`)})}),t.length>0?(console.error("Configuration validation failed:",t),!1):(console.log("Configuration validation passed"),!0)}const Ge={SAVE:Pe};class Oe{constructor(){this.currentLevel=K.DEFAULT_LOG_LEVEL,this.setLevel(K.DEFAULT_LOG_LEVEL)}setLevel(e){this.currentLevel=e}shouldLog(e){return e==="error"}formatMessage(e,n,s){const o=`[${new Date().toLocaleTimeString()}] [${e.toUpperCase()}]`;return s?`${o} ${n}`:`${o} ${n}`}error(e,n){this.shouldLog("error")&&console.error(this.formatMessage("error",e),n||"")}warn(e,n){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",e),n||"")}info(e,n){this.shouldLog("info")&&console.log(this.formatMessage("info",e),n||"")}debug(e,n){this.shouldLog("debug")&&console.log(this.formatMessage("debug",e),n||"")}time(e){this.shouldLog("debug")&&console.time(e)}timeEnd(e){this.shouldLog("debug")&&console.timeEnd(e)}saveOperation(e,n){this.info(`[SAVE] ${e}`,n)}gameAction(e,n){this.debug(`[GAME] ${e}`,n)}apiCall(e,n,s){const i=s?` (${s})`:"";this.debug(`[API] ${n} ${e}${i}`)}}const I=new Oe;let U=null,ne=!1;const w={debouncedSave(){U&&clearTimeout(U),U=setTimeout(()=>{I.saveOperation("Debounced save triggered"),te()},Ge.SAVE.DEBOUNCE_DELAY)},startAutoSave(){ne||(ne=!0,I.info("Auto-save enabled - saves complete game data every 30 seconds"),this._autoId=setInterval(async()=>{localStorage.getItem("authToken")&&(I.saveOperation("Auto-save triggered (30s interval)"),await te())},3e4))},stopAutoSave(){this._autoId&&(clearInterval(this._autoId),this._autoId=null),U&&(clearTimeout(U),U=null),ne=!1},async saveNow(){return localStorage.getItem("authToken")?await te():!1},listSlots(){return[]},getSlotInfo(){return null},saveToSlot(){return this.saveNow()},loadFromSlot(){return Promise.resolve(!1)},deleteSlot(){},createDefaultState(){return{stats:{hp:100,hpMax:100,stamina:100,staminaMax:100,mana:100,manaMax:100},fishing:{level:1,xp:0,xpToNext:100},exploration:{level:1,xp:0,xpToNext:100},combat:{attack:{level:1,xp:0,xpToNext:100},strength:{level:1,xp:0,xpToNext:100},defense:{level:1,xp:0,xpToNext:100}},foraging:{level:1,xp:0,xpToNext:100},inventory:[{name:"Leather Helmet",count:1,type:"helmet"},{name:"Leather Chest",count:1,type:"chest"},{name:"Leather Gloves",count:1,type:"gloves"},{name:"Leather Pants",count:1,type:"pants"},{name:"Leather Boots",count:1,type:"shoes"},{name:"Fishing Pole",count:1}],equipment:{helmet:null,chest:null,gloves:null,pants:null,shoes:null,ring1:null,ring2:null,amulet:null},invCapacity:25,coins:0,isFishing:!1,isExploring:!1,discoveredFishingSpot:!1,activeView:"explore",discoveries:[]}},async newGame(){const t=this.createDefaultState();Object.assign(r,t),await this.saveNow();try{localStorage.removeItem("sandboxIdleState"),localStorage.removeItem("fish_discovered");for(let e=localStorage.length-1;e>=0;e--){const n=localStorage.key(e);n&&n.startsWith("zone_pos_")&&localStorage.removeItem(n)}}catch{}window.location.reload()}},Z=Object.freeze(Object.defineProperty({__proto__:null,SaveManager:w},Symbol.toStringTag,{value:"Module"}));function Q(t,e,n=!1){let s=null,i;return function(...a){const l=()=>{s=null,n||(i=t(...a))},c=n&&!s;return s!==null&&clearTimeout(s),s=window.setTimeout(l,e),c&&(i=t(...a)),i}}function Fe(t,e){let n;return function(...s){n||(t.apply(this,s),n=!0,setTimeout(()=>n=!1,e))}}class Re{constructor(){this.callbacks=[],this.rafId=null}add(e){this.callbacks.push(e),this.rafId===null&&(this.rafId=requestAnimationFrame(()=>this.flush()))}flush(){const e=this.callbacks.slice();this.callbacks.length=0,this.rafId=null,e.forEach(n=>{try{n()}catch(s){x.error("Error in RAF batch callback:",s)}})}}const De=new Re;function J(t){De.add(()=>{t.forEach(e=>{try{e()}catch(n){x.error("Error in DOM update batch:",n)}})})}class $e{constructor(e,n,s=10){this.pool=[],this.createFn=e,this.resetFn=n;for(let i=0;i<s;i++)this.pool.push(e())}get(){return this.pool.length>0?this.pool.pop():this.createFn()}release(e){try{this.resetFn(e),this.pool.push(e)}catch(n){x.warn("Error resetting pooled object:",n)}}clear(){this.pool.length=0}}new $e(()=>document.createElement("div"),t=>{t.className="",t.innerHTML="",t.removeAttribute("style"),t.removeAttribute("data-index"),t.parentNode&&t.parentNode.removeChild(t)});class Ve{constructor(e={}){this.callbacks=new Map,this.observer=new IntersectionObserver(n=>{n.forEach(s=>{if(s.isIntersecting){const i=this.callbacks.get(s.target);i&&(i(),this.unobserve(s.target))}})},{rootMargin:"50px",threshold:.1,...e})}observe(e,n){this.callbacks.set(e,n),this.observer.observe(e)}unobserve(e){this.callbacks.delete(e),this.observer.unobserve(e)}disconnect(){this.observer.disconnect(),this.callbacks.clear()}}new Ve;class Ue{constructor(){this.metrics=new Map}time(e){console.time(e)}timeEnd(e){console.timeEnd(e)}mark(e,n){this.metrics.has(e)||this.metrics.set(e,[]);const s=this.metrics.get(e);s.push(n),s.length>100&&s.shift()}getAverage(e){const n=this.metrics.get(e);return!n||n.length===0?0:n.reduce((s,i)=>s+i,0)/n.length}getStats(e){const n=this.metrics.get(e);if(!n||n.length===0)return{count:0,average:0,min:0,max:0};const s=[...n].sort((i,o)=>i-o);return{count:n.length,average:this.getAverage(e),min:s[0],max:s[s.length-1],median:s[Math.floor(s.length/2)]}}logStats(){console.group("Performance Stats");for(const[e,n]of this.metrics){const s=this.getStats(e);console.log(`${e}:`,s)}console.groupEnd()}}const W=new Ue;class He{constructor(){this.frames=[],this.lastTime=performance.now(),this.rafId=null,this.callback=null}start(e){e&&(this.callback=e||null,this.tick())}stop(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null)}tick(){const e=performance.now(),n=e-this.lastTime;this.lastTime=e,this.frames.push(1e3/n),this.frames.length>60&&this.frames.shift();const s=this.frames.reduce((i,o)=>i+o,0)/this.frames.length;this.callback&&this.callback(Math.round(s)),this.rafId=requestAnimationFrame(()=>this.tick())}}new He;let C=null;function se(t){C=t}window.__equipmentApi||(window.__equipmentApi={});window.__equipmentApi.equipItem=(t,e)=>D.equipItem(t,e);const D={slotMapping:{helmet:["helmet"],chest:["chest"],gloves:["gloves"],pants:["pants"],shoes:["shoes"],ring:["ring1","ring2"],amulet:["amulet"]},currentHighlightSource:null,init(){this.setupSlots(),this.updateUI(),this.debouncedUpdateUI=Q(()=>this.updateUI(),16),this.throttledClearHighlights=Fe(()=>this.clearHighlights(),16)},setupSlots(){j(".equipment-slot").forEach(t=>{t.addEventListener("dragover",e=>{e.preventDefault(),t.classList.add("drag-over");const n=r.inventory[(C==null?void 0:C.dragFromIndex)??null],s=n&&this.canEquip(n.type,t.dataset.slot);t.classList.toggle("slot-invalid",!s);const i=!!r.equipment[t.dataset.slot];t.classList.toggle("slot-occupied",!!s&&i)}),t.addEventListener("dragleave",()=>t.classList.remove("drag-over","slot-invalid","slot-occupied")),t.addEventListener("drop",e=>{e.preventDefault(),t.classList.remove("drag-over","slot-invalid","slot-occupied");const n=t.dataset.slot,s=C==null?void 0:C.dragFromIndex,i=r.inventory[s];i&&this.canEquip(i.type,n)&&this.equipItem(i,s),C&&(C.dragFromIndex=null)})})},canEquip(t,e){return t===e||t==="ring"&&(e==="ring1"||e==="ring2")},equipItem(t,e){let n=t.type;if(t.type==="ring"&&(n=r.equipment.ring1?"ring2":"ring1"),r.equipment[n]){const s=r.equipment[n];r.inventory.push(s)}r.equipment[n]=t,r.inventory.splice(e,1),C&&C.debouncedRender(),this.debouncedUpdateUI(),v.playEquip(),w.debouncedSave()},unequipItem(t){const e=r.equipment[t];e&&(r.inventory.push(e),r.equipment[t]=null,C&&C.debouncedRender(),this.debouncedUpdateUI(),w.debouncedSave())},updateUI(){W.time("equipment-ui-update"),J([()=>{j(".equipment-slot").forEach(t=>{const e=t.dataset.slot,n=t.querySelector(".slot-item"),s=r.equipment[e];s&&n?this.renderEquippedItem(n,s,e):n&&this.renderEmptySlot(n)})}]),W.timeEnd("equipment-ui-update")},renderEquippedItem(t,e,n){const s=C?C.createItemIcon(e):null;if(!s){t.innerHTML="",t.classList.add("empty");return}s.setAttribute("width","20"),s.setAttribute("height","20"),t.innerHTML="",t.appendChild(s),t.classList.remove("empty"),this.setupItemEventListeners(t,e,n)},renderEmptySlot(t){var n;t.innerHTML="",t.classList.add("empty");const e=t.cloneNode(!0);(n=t.parentNode)==null||n.replaceChild(e,t)},setupItemEventListeners(t,e,n){t.addEventListener("mouseenter",s=>N.show(s,e.name)),t.addEventListener("mouseleave",()=>N.hide()),t.addEventListener("mousemove",s=>N.move(s)),t.addEventListener("mousedown",()=>{try{N.hide()}catch{}}),t.draggable=!0,t.addEventListener("dragstart",()=>{C&&(C.dragFromEquipment=n),t.classList.add("dragging");try{N.hide()}catch{}v.playPickup()}),t.addEventListener("dragend",()=>{t.classList.remove("dragging"),C&&(C.dragFromEquipment=null)}),t.addEventListener("contextmenu",s=>{s.preventDefault(),this.unequipItem(n),v.playClick()})},debouncedUpdateUI:Q(function(){this.updateUI()},16),highlightSlots(t,e="hover"){this.currentHighlightSource=e,this.throttledClearHighlights();const n=this.slotMapping[t];n&&J([()=>{n.forEach(s=>{const i=document.querySelector(`[data-slot="${s}"]`);i&&i.classList.add("compatible-highlight")})}])},clearHighlights(t="hover"){(this.currentHighlightSource===t||t==="force"||!this.currentHighlightSource)&&(J([()=>{j(".equipment-slot").forEach(e=>e.classList.remove("compatible-highlight"))}]),this.currentHighlightSource=null)}},ie=Object.freeze(Object.defineProperty({__proto__:null,Equipment:D,setInventory:se},Symbol.toStringTag,{value:"Module"})),X=class X{static initialize(){window.addEventListener("error",e=>{this.handleError(new Error(e.message),{component:"global",operation:"runtime",timestamp:Date.now()})}),window.addEventListener("unhandledrejection",e=>{this.handleError(new Error(e.reason),{component:"global",operation:"promise",timestamp:Date.now()})}),x.info("Error handler initialized")}static handleError(e,n={}){const s=this.enrichError(e,n);this.logError(s),this.queueError(s),s.recoverable!==!1&&this.attemptRecovery(s),(s.severity==="high"||s.severity==="critical")&&this.showUserNotification(s)}static wrap(e,n={}){return(...s)=>{try{const i=e(...s);return i instanceof Promise?i.catch(o=>(this.handleError(o,n),this.getDefaultValue(n.operation))):i}catch(i){return this.handleError(i,n),this.getDefaultValue(n.operation)}}}static async wrapAsync(e,n={}){try{return await e()}catch(s){return this.handleError(s,n),null}}static safe(e,n,s={}){try{return e()}catch(i){return this.handleError(i,{...s,severity:"low"}),n}}static async retry(e,n={},s=this.maxRetries){const i=n.operation||"unknown",o=this.retryAttempts.get(i)||0;try{const a=await e();return this.retryAttempts.delete(i),a}catch(a){if(o<s){this.retryAttempts.set(i,o+1),x.warn(`Retrying operation ${i}, attempt ${o+1}/${s}`);const l=Math.pow(2,o)*1e3;return await new Promise(c=>setTimeout(c,l)),this.retry(e,n,s)}else return this.retryAttempts.delete(i),this.handleError(a,{...n,severity:"high"}),null}}static validateGameState(e){try{if(!e||typeof e!="object")throw new Error("Invalid game state: not an object");const n=["inventory","equipment","stats","skills"];for(const s of n)if(!(s in e))throw new Error(`Invalid game state: missing ${s}`);return Array.isArray(e.inventory)||(e.inventory=new Array(16).fill(null),x.warn("Fixed corrupted inventory")),(!e.equipment||typeof e.equipment!="object")&&(e.equipment={helmet:null,chest:null,gloves:null,pants:null,shoes:null,ring1:null,ring2:null,amulet:null},x.warn("Fixed corrupted equipment")),!0}catch(n){return this.handleError(n,{component:"gameState",operation:"validation",severity:"critical"}),!1}}static getUserMessage(e){return{"save-failed":"Could not save your progress. Your changes may be lost.","load-failed":"Could not load your saved game. Starting fresh.","network-error":"Connection problem. Please check your internet.","inventory-full":"Your inventory is full! Please make some space.","invalid-item":"This item appears to be corrupted and was removed.","feature-unavailable":"This feature is temporarily unavailable."}[e.code]||"Something went wrong, but the game should continue working."}static reportError(e){}static enrichError(e,n){const s=e;return s.component=n.component||s.component||"unknown",s.operation=n.operation||s.operation||"unknown",s.context={...n,timestamp:Date.now()},s.severity=s.severity||"medium",s.recoverable=s.recoverable!==!1,s}static logError(e){const n={low:"warn",medium:"error",high:"error",critical:"error"}[e.severity||"medium"];x[n](`[${e.component}:${e.operation}] ${e.message}`,e)}static queueError(e){this.errorQueue.push(e),this.errorQueue.length>this.maxQueueSize&&this.errorQueue.shift()}static attemptRecovery(e){try{switch(e.component){case"inventory":this.recoverInventory();break;case"equipment":this.recoverEquipment();break;case"save":this.recoverSaveSystem();break;default:break}}catch(n){x.error("Recovery failed",n)}}static recoverInventory(){var e;try{document.getElementById("inv-grid")&&typeof((e=window.Inventory)==null?void 0:e.render)=="function"&&(window.Inventory.render(),x.info("Inventory recovered"))}catch(n){x.error("Inventory recovery failed",n)}}static recoverEquipment(){var e;try{typeof((e=window.Equipment)==null?void 0:e.updateUI)=="function"&&(window.Equipment.updateUI(),x.info("Equipment recovered"))}catch(n){x.error("Equipment recovery failed",n)}}static recoverSaveSystem(){try{x.info("Attempting save system recovery")}catch(e){x.error("Save system recovery failed",e)}}static showUserNotification(e){try{const n=this.getUserMessage(e),s=document.getElementById("status");s&&(s.textContent=n,s.style.color="#ff6b6b",setTimeout(()=>{s.style.color=""},5e3)),console.warn("Game Error:",n)}catch(n){x.error("Failed to show user notification",n)}}static getDefaultValue(e){return{render:void 0,save:!1,load:null,addItem:!1,removeItem:!1}[e||"unknown"]||null}static getErrorQueue(){return[...this.errorQueue]}static getRetryAttempts(){return new Map(this.retryAttempts)}};X.errorQueue=[],X.maxQueueSize=100,X.retryAttempts=new Map,X.maxRetries=3;let L=X;L.handleError.bind(L);L.wrap.bind(L);L.wrapAsync.bind(L);L.safe.bind(L);L.retry.bind(L);L.validateGameState.bind(L);const P={slots:16,dragFromIndex:null,dragFromEquipment:null,init(){L.wrap(()=>{this.setupDragAndDrop(),this.initCoinPouch();try{typeof window<"u"&&(window.Inventory=this)}catch{}this.debouncedRender=Q(()=>this.render(),16)},{component:"inventory",operation:"init"})()},render(){return L.wrap(()=>{W.time("inventory-render");const t=document.getElementById("inv-grid");t&&(J([()=>{t.innerHTML="",t.style.gridTemplateColumns="repeat(4, 56px)",t.style.gridTemplateRows="repeat(4, 56px)"},()=>{const e=document.createDocumentFragment();for(let n=0;n<this.slots;n++){const s=document.createElement("div");s.className="slot",s.dataset.index=n;const i=document.createElement("div");i.className="cell",i.dataset.index=n,this.setupCellEventListeners(i,n);const o=r.inventory[n];o?(i.classList.add("occupied"),this.createItemElement(i,o,n)):i.classList.add("empty"),s.appendChild(i),e.appendChild(s)}t.appendChild(e)}]),this.updateCoinCount(),W.timeEnd("inventory-render"))},{component:"inventory",operation:"render"})()},updateCoinCount(){const t=document.querySelector("#coin-count");if(!t)return;const e=r.coins||0;t.textContent=e.toLocaleString()},addCoins(t=1){r.coins||(r.coins=0),r.coins+=t,this.updateCoinCount(),w.debouncedSave()},setupCellEventListeners(t,e){t.addEventListener("dragover",n=>{n.preventDefault(),t.classList.add("drag-over")}),t.addEventListener("dragleave",()=>t.classList.remove("drag-over")),t.addEventListener("drop",()=>{t.classList.remove("drag-over");const n=e;if(this.dragFromIndex!==null){const s=this.dragFromIndex;if(s===n)return;const i=r.inventory[n]||null;r.inventory[n]=r.inventory[s],r.inventory[s]=i,this.dragFromIndex=null,this.debouncedRender(),v.playDrop(),w.debouncedSave();return}if(this.dragFromEquipment)if(r.inventory[n])this.dragFromEquipment=null;else{const s=r.equipment[this.dragFromEquipment];s&&(r.inventory[n]=s,r.equipment[this.dragFromEquipment]=null,this.dragFromEquipment=null,this.debouncedRender(),F(()=>Promise.resolve().then(()=>ie),void 0).then(i=>i.Equipment.updateUI()),v.playDrop(),w.debouncedSave())}})},debouncedRender:Q(function(){this&&this.render?this.render():console.warn("debouncedRender called without proper context")},16),createItemElement(t,e,n){const s=document.createElement("div");s.className="item",s.draggable=!0,s.dataset.index=n;const i=this.createItemIcon(e);if(s.appendChild(i),e.count>1){const o=document.createElement("div");o.className="item-count",o.textContent=e.count,s.appendChild(o)}this.addItemEventListeners(s,e,n),t.appendChild(s)},createItemIcon(t){var l;const e=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","use");let s="icon-bag",i="#8B4513";const o={helmet:{symbol:"icon-helmet",color:"#8B4513"},chest:{symbol:"icon-chest-armor",color:"#A0522D"},gloves:{symbol:"icon-gloves",color:"#D2691E"},pants:{symbol:"icon-pants",color:"#CD853F"},shoes:{symbol:"icon-boots",color:"#DEB887"},ring:{symbol:"icon-ring",color:"#FFD700"},amulet:{symbol:"icon-amulet",color:"#9370DB"}},a={Minnow:{symbol:"fish-minnow",color:"#87CEEB"},Trout:{symbol:"fish-trout",color:"#8FBC8F"},Bass:{symbol:"fish-bass",color:"#556B2F"},Salmon:{symbol:"fish-salmon",color:"#FA8072"},"Golden Carp":{symbol:"fish-carp",color:"#FFD700"}};t.type&&o[t.type]?(s=o[t.type].symbol,i=o[t.type].color):(l=ee[t.name])!=null&&l.icon?s=ee[t.name].icon:a[t.name]&&(s=a[t.name].symbol,i=a[t.name].color),n.setAttribute("href",`#${s}`);try{n.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${s}`)}catch{}return e.appendChild(n),e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.style.color=i,e},addItemEventListeners(t,e,n){t.addEventListener("mouseenter",s=>{N.show(s,e.name),e.type&&D.highlightSlots(e.type,"hover")}),t.addEventListener("mouseleave",()=>{N.hide(),e.type&&D.clearHighlights("hover")}),t.addEventListener("mousemove",s=>N.move(s)),t.addEventListener("contextmenu",s=>{var i;if(s.preventDefault(),e!=null&&e.type){const o=((i=window.__equipmentApi)==null?void 0:i.equipItem)||null;o?o(e,n):F(()=>Promise.resolve().then(()=>ie),void 0).then(a=>a.Equipment.equipItem(e,n)),v.playClick()}}),t.addEventListener("dragstart",s=>{this.dragFromIndex=n,t.classList.add("dragging");try{N.hide()}catch{}try{s.dataTransfer&&(s.dataTransfer.setData("application/x-inv-idx",String(n)),s.dataTransfer.setData("text/x-inv-idx",String(n)),s.dataTransfer.effectAllowed="move")}catch{}v.playPickup()}),t.addEventListener("mousedown",()=>{try{N.hide()}catch{}}),t.addEventListener("dragend",()=>{t.classList.remove("dragging"),setTimeout(()=>{this.dragFromIndex=null},10),D.clearHighlights("force")})},addItem(t,e=null){if(t==="Coin"||t==="Coins"||t==="Gold Coin"||t==="Small Coin"){this.addCoins(1);return}const n=r.inventory.find(i=>i&&i.name===t&&(i.type||null)===(e||null));if(n){n.count++,this.debouncedRender(),w.debouncedSave();return}for(let i=0;i<this.slots;i++)if(!r.inventory[i]){r.inventory[i]={name:t,count:1,type:e||null},this.debouncedRender(),w.debouncedSave();return}const s=document.getElementById("game-log");if(s){const i=document.createElement("div");i.className="log-entry",i.textContent="Inventory is full!",s.prepend(i)}},setupDragAndDrop(){return L.wrap(()=>{const t=document.getElementById("inv-grid");t&&(t.addEventListener("dragover",e=>e.preventDefault()),t.addEventListener("drop",e=>{e.preventDefault(),this.dragFromIndex!==null&&console.log("Dropped on grid, keeping item in original position"),this.dragFromIndex=null,this.dragFromEquipment=null}))},{component:"inventory",operation:"setupDragAndDrop"})()},setupSortButton(){const t=document.getElementById("sort-inventory-btn");t&&t.addEventListener("click",()=>{this.sortByName(),v.playClick()})},initCoinPouch(){const t=setInterval(()=>{document.querySelector(".coin-pouch")&&(this.updateCoinCount(),clearInterval(t))},100)},sortByName(){const t=r.inventory.filter(Boolean),e=r.inventory.length-t.length;t.sort((s,i)=>s.name.localeCompare(i.name)),r.inventory=[...t,...new Array(e).fill(null)],this.debouncedRender(),w.debouncedSave();const n=document.getElementById("status");n&&(n.textContent="Inventory sorted")}},Xe=[{name:"Minnow",weight:50,xp:2,minLevel:1,color:"#60a5fa",icon:"fish-minnow"},{name:"Trout",weight:30,xp:5,minLevel:3,color:"#34d399",icon:"fish-trout"},{name:"Bass",weight:15,xp:8,minLevel:5,color:"#10b981",icon:"fish-bass"},{name:"Salmon",weight:4,xp:12,minLevel:8,color:"#f59e0b",icon:"fish-salmon"},{name:"Golden Carp",weight:1,xp:20,minLevel:12,color:"#d4af37",icon:"fish-carp"}],he={fishTypes:Xe,init(){this.debouncedUpdateUI=Q(()=>this.updateUI(),16)},start(){if(r.isFishing)return;r.isFishing=!0;const t=document.getElementById("fishBtn");t&&(t.disabled=!0,t.setAttribute("aria-busy","true"));const e=document.getElementById("status");e&&(e.textContent="Casting line...");const n=1800+Math.random()*2200;setTimeout(()=>{const s=this.catchFish();this.completeFishing(s)},n),v.playClick()},catchFish(){const t=this.fishTypes.reduce((n,s)=>n+s.weight,0);let e=Math.random()*t;for(const n of this.fishTypes)if(e-=n.weight,e<=0)return n;return this.fishTypes[0]},completeFishing(t){r.isFishing=!1;const e=document.getElementById("fishBtn");e&&(e.disabled=!1,e.removeAttribute("aria-busy")),P.addItem(t.name),this.gainXP(t.xp);const n=document.getElementById("status");n&&(n.textContent=`Caught a ${t.name}! (+${t.xp} XP)`),r.stats.stamina=q(r.stats.stamina-5,0,r.stats.staminaMax),r.stats.mana=q(r.stats.mana-2,0,r.stats.manaMax);const s=document.getElementById("stamina-bar");s&&(s.style.width=`${r.stats.stamina/r.stats.staminaMax*100}%`);const i=document.getElementById("mana-bar");i&&(i.style.width=`${r.stats.mana/r.stats.manaMax*100}%`),w.debouncedSave()},gainXP(t){for(W.time("fishing-xp-update"),r.fishing.xp+=t;r.fishing.xp>=r.fishing.xpToNext;)r.fishing.xp-=r.fishing.xpToNext,r.fishing.level++,r.fishing.xpToNext=Math.floor(r.fishing.xpToNext*1.2);this.debouncedUpdateUI(),W.timeEnd("fishing-xp-update")},updateUI(){J([()=>{try{const t=document.getElementById("fishing-level-display");t&&(t.textContent=String(r.fishing.level));const e=document.getElementById("exp-display");e&&(e.textContent=String(r.fishing.xp));const n=document.getElementById("exp-needed-display");n&&(n.textContent=String(r.fishing.xpToNext))}catch{}},()=>{const t=document.querySelector('[data-skill-level="fishing"]');t&&(t.textContent=r.fishing.level);const e=document.querySelector('.skill-card[data-skill="fishing"]');if(e){const n=Math.min(100,r.fishing.xp/r.fishing.xpToNext*100);e.style.setProperty("--progress-pct",`${n}%`);try{const s=e.querySelector(".skill-icon-large svg");if(s){s.classList.add("fish-animated");const i=s.querySelector("use")||document.createElementNS("http://www.w3.org/2000/svg","use");i.parentNode||s.appendChild(i),i.setAttribute("href","#fish-koi")}}catch{}}}])}};class O{static init(){if(this.running)return;this.running=!0,this.lastTickAt=typeof performance<"u"&&performance.now?performance.now():Date.now();const e=()=>{if(this.running){try{this.tick()}catch{}this.frameReq=typeof requestAnimationFrame<"u"?requestAnimationFrame(e):setTimeout(e,this.tickIntervalMs)}};e()}static tick(){const e=typeof performance<"u"&&performance.now?performance.now():Date.now(),n=e-this.lastTickAt,s=Math.max(0,Math.min(1e3,n||0));this.lastTickAt=e,this.accumulatorMs+=s;const i=this.tickIntervalMs,o=5;let a=0;for(;this.accumulatorMs>=i&&a<o;)this._processStep(i),this.accumulatorMs-=i,a+=1}static _processStep(e){const n={0:[],1:[],2:[]};for(const[s,i]of Array.from(this.jobsById.entries())){if(!i||i.cancelled){this.jobsById.delete(s);continue}if(i.paused)continue;const o=this.priorities[i.priority]??1;n[o].push([s,i])}for(const s of[0,1,2]){const i=n[s];for(const[o,a]of i){try{a.tick(e)}catch{}if(a.complete){this.jobsById.delete(o);try{a.emit("complete")}catch{}}}}}static addJob(e){const n=e.id||`job_${Date.now()}_${Math.floor(Math.random()*1e6)}`;e.id=n,e.manager=this,e.priority||(e.priority="normal"),this.jobsById.set(n,e);try{e.emit("added")}catch{}return e}static removeJob(e){const n=this.jobsById.get(e);if(n){n.cancelled=!0,this.jobsById.delete(e);try{n.emit("removed")}catch{}}}static pauseJob(e,n){const s=this.jobsById.get(e);if(s){s.paused=!!n;try{s.emit("paused",!!n)}catch{}}}static hasActiveOfKind(e){for(const n of this.jobsById.values())if(n&&!n.cancelled&&!n.complete&&n.kind===e)return!0;return!1}static hasAnyActive(){for(const e of this.jobsById.values())if(e&&!e.cancelled&&!e.complete)return!0;return!1}static cancelAllOfKind(e){const n=[];for(const[s,i]of this.jobsById.entries())i&&!i.cancelled&&!i.complete&&i.kind===e&&n.push(s);n.forEach(s=>this.removeJob(s))}}$(O,"jobsById",new Map),$(O,"running",!1),$(O,"frameReq",0),$(O,"lastTickAt",0),$(O,"tickIntervalMs",250),$(O,"accumulatorMs",0),$(O,"priorities",{high:0,normal:1,low:2});class ze{constructor(e){this.kind=e,this.id="",this.paused=!1,this.cancelled=!1,this.complete=!1,this.listeners=new Map}on(e,n){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(n),()=>this.off(e,n)}off(e,n){const s=this.listeners.get(e);s&&s.delete(n)}emit(e,...n){const s=this.listeners.get(e);if(s)for(const i of Array.from(s.values()))try{i(...n)}catch{}}}class et extends ze{constructor(e){super("fishing");const{remaining:n=1,fishTypes:s=[],playerLevel:i=1,rng:o=Math.random}=e||{};this.remaining=Math.max(0,n|0),this.fishTypes=Array.isArray(s)?s.slice():[],this.playerLevel=Math.max(1,i|0),this.rng=o,this.progress=0,this.currentFish=this.pickFish(),this.emit("fishChanged",this.currentFish)}pickFish(){if(!this.fishTypes||this.fishTypes.length===0)return{name:"Minnow",weight:1,xp:1};const e=this.fishTypes.reduce((s,i)=>s+(i.weight||0),0)||1;let n=this.rng()*e;for(const s of this.fishTypes)if(n-=s.weight||0,n<=0)return s;return this.fishTypes[0]}ratePerSecondForFish(e){const s=Math.max(...this.fishTypes.map(c=>c.weight||1),1),i=1-(e.weight||1)/s,o=Math.min(.3,(this.playerLevel-1)*.03),a=i*.4,l=.1*(1+o)*(1-a);return Math.max(.02,l)}tick(e){if(this.complete||this.cancelled||this.paused)return;if(this.remaining<=0){this.complete=!0;return}const n=e/1e3,s=this.ratePerSecondForFish(this.currentFish);if(this.progress+=s*n,this.progress>=1){this.progress-=1;const i=this.currentFish;this.emit("catch",i);try{const o=new Set(JSON.parse(localStorage.getItem("fish_discovered")||"[]"));o.add(String((i==null?void 0:i.name)||"")),localStorage.setItem("fish_discovered",JSON.stringify(Array.from(o.values())));try{F(async()=>{const{SaveManager:a}=await Promise.resolve().then(()=>Z);return{SaveManager:a}},void 0).then(({SaveManager:a})=>{a.debouncedSave()})}catch{}}catch{}if(this.remaining-=1,this.emit("remainingChanged",this.remaining),this.remaining<=0){this.complete=!0;return}this.currentFish=this.pickFish(),this.emit("fishChanged",this.currentFish)}this.emit("progress",Math.max(0,Math.min(1,this.progress)))}}const z={maxCards:Me,pinnedIds:new Set,_groundAttached:!1,attachGroundDropHandlers(){if(this._groundAttached)return;const t=document.querySelector(".game-content")||document.querySelector(".content-panel.active")||document.getElementById("game");t&&(this._groundAttached=!0,t.addEventListener("dragover",e=>{e.preventDefault();const n=window==null?void 0:window.Inventory,s=e.dataTransfer.types.includes("text/ground-item");(n&&(n.dragFromIndex!==null||n.dragFromEquipment)||s)&&t.classList.add("drag-over")}),t.addEventListener("dragleave",()=>{t.classList.remove("drag-over")}),t.addEventListener("drop",e=>{e.preventDefault(),t.classList.remove("drag-over");const n=e.dataTransfer.getData("text/ground-item");if(n){const l=document.querySelector(`[data-card-id="${n}"]`);if(l){this.repositionGroundItem(l,e.clientX,e.clientY),v.playDrop();return}}const s=e.target;if(s==null?void 0:s.closest(".panel, .inventory-panel, .equipment-panel, .skills-panel, .chat-panel, #inv-grid, .equipment-slot, .skill-card, .slot")){console.log("Dropped on panel, no ground item created");return}let o=null;const a=window==null?void 0:window.Inventory;if(console.log("Drop detected - dragFromIndex:",a==null?void 0:a.dragFromIndex,"dragFromEquipment:",a==null?void 0:a.dragFromEquipment),a&&a.dragFromIndex!==null&&a.dragFromIndex!==void 0){const l=a.dragFromIndex,c=r.inventory[l];console.log("Processing inventory drop for index",l,"item:",c),c&&c.name&&(o={name:c.name,type:c.type,count:c.count||1},r.inventory[l]=null,console.log("Removed item from inventory slot",l),P.debouncedRender())}if(a&&a.dragFromEquipment){const l=a.dragFromEquipment,c=r.equipment[l];console.log("Processing equipment drop for slot",l,"item:",c),c&&c.name&&(o={name:c.name,type:c.type},r.equipment[l]=null,F(()=>Promise.resolve().then(()=>ie),void 0).then(h=>h.Equipment.debouncedUpdateUI()))}if(o&&o.name&&o.name!=="Unknown"){console.log("Creating ground item:",o),document.getElementById("discoveries");const l=e.clientX,c=e.clientY;v.playDrop(),this.createGroundItem({name:o.name,type:(o==null?void 0:o.type)||null,count:(o==null?void 0:o.count)||1},{spawnAtClient:{x:l,y:c}})}else console.log("No valid item to drop");a&&(a.dragFromIndex=null,a.dragFromEquipment=null)}))},repositionGroundItem(t,e,n){const s=t.parentElement;if(!s)return;const i=s.getBoundingClientRect(),o=t.getBoundingClientRect(),a=e-i.left-o.width/2,l=n-i.top-o.height/2,c=8,h=i.width-o.width-c,p=i.height-o.height-c,f=Math.max(c,Math.min(h,a)),m=Math.max(c,Math.min(p,l));t.style.left=`${f}px`,t.style.top=`${m}px`},start(){var o;try{if(O.hasAnyActive()){const a=document.getElementById("status");a&&(a.textContent="Finish your current activity before exploring.");return}}catch{}if(r.isExploring)return;r.isExploring=!0;const t=document.getElementById("locationBadge");t&&(t.classList.add("exploring"),t.classList.remove("discovered"));const e=document.getElementById("exploreBtn");e&&e.classList.add("exploring");const n=document.getElementById("exploreBtn"),s=document.getElementById("exploreBtnLabel");n&&(n.classList.add("active"),n.setAttribute("aria-pressed","true")),s&&(s.textContent="Stop Exploring");const i=document.getElementById("status");i&&(i.textContent="Exploring...");try{v.startWalkingSounds()}catch{}try{(o=document.getElementById("locationBadge"))==null||o.classList.remove("discovered")}catch{}this.continue();try{v.playClick()}catch{}try{this.attachGroundDropHandlers()}catch{}},stop(){if(!r.isExploring)return;r.isExploring=!1;const t=document.getElementById("locationBadge");t&&t.classList.remove("exploring");const e=document.getElementById("exploreBtn");e&&e.classList.remove("exploring");const n=document.getElementById("exploreBtn"),s=document.getElementById("exploreBtnLabel");n&&(n.classList.remove("active"),n.setAttribute("aria-pressed","false")),s&&(s.textContent="Explore");try{v.stopWalkingSounds()}catch{}},continue(){if(!r.isExploring)return;const t=5e3,e=(r.exploration.level-1)*200,n=Math.max(2e3,t-e);setTimeout(()=>this.rollForDiscovery(),n)},rollForDiscovery(){if(!r.isExploring)return;const e=85+r.exploration.level*2;if(Math.random()*100<e){const s=document.getElementById("discoveries"),i=()=>s?s.querySelectorAll(".ground-item").length:0;let o=1;Math.random()<.35&&(o+=1),Math.random()<.15&&(o+=1),Math.random()<.05&&(o+=1);for(let a=0;a<o;a++){const l=this.getRandomDiscovery();l&&i()<this.maxCards&&this.createGroundItem(l)}this.continue()}else{const s=["Walking along the sandy shoreline...","Searching through washed-up seaweed...","Looking for shells in the tide pools...","Checking behind weathered driftwood..."],i=document.getElementById("status");i&&(i.textContent=s[Math.floor(Math.random()*s.length)]),r.stats.stamina=q(r.stats.stamina-3,0,r.stats.staminaMax),r.stats.mana=q(r.stats.mana-1,0,r.stats.manaMax);const o=document.getElementById("stamina-bar");o&&(o.style.width=`${r.stats.stamina/r.stats.staminaMax*100}%`);const a=document.getElementById("mana-bar");a&&(a.style.width=`${r.stats.mana/r.stats.manaMax*100}%`),this.gainXP(1),w.debouncedSave(),this.continue()}},getRandomDiscovery(){var i;const t=((i=V==null?void 0:V.current)==null?void 0:i.key)||"beach",n=(ce[t]||ce.beach||[]).filter(o=>(o.minLevel||1)<=r.exploration.level),s=[];return n.forEach(o=>{for(let a=0;a<(o.rarity||1);a++)s.push(o)}),s[Math.floor(Math.random()*Math.max(1,s.length))]},arrange(t="spiral"){const e=document.getElementById("discoveries");if(!e)return;const n=Array.from(e.querySelectorAll(".ground-item")),s=e.getBoundingClientRect(),i=s.width/2,o=s.height/2,a=100,l=36,c=Math.PI/6;n.forEach((h,p)=>{if(this.pinnedIds.has(h.dataset.cardId))return;let f=i,m=o;if(t==="spiral"){const d=a+p*(l*.55),u=p*c;f=i+d*Math.cos(u),m=o+d*Math.sin(u)}else if(t==="flower"){const u=a+p%6*18+Math.floor(p/6)*28,g=p%6*(Math.PI*2/6)+Math.floor(p/6)*.5;f=i+u*Math.cos(g),m=o+u*Math.sin(g)}else if(t==="orbit"){const d=Math.floor(p/8),u=a+d*80,g=8+d*4,E=p%g*(Math.PI*2/g);f=i+u*Math.cos(E),m=o+u*Math.sin(E)}h.style.transition="left 220ms ease, top 220ms ease";const b=h.offsetWidth||56,S=h.offsetHeight||56;h.style.left=`${f-b/2}px`,h.style.top=`${m-S/2}px`,setTimeout(()=>h.style.transition="none",240)})},tidy(){this.arrange("spiral")},animateToInventory(t){try{const e=document.getElementById("toggleInventory"),n=document.getElementById("inv-grid");if(!e&&!n)return;const s=t.querySelector(".disc-icon svg, .idle-ring-inner svg");if(!s)return;const i=s.getBoundingClientRect(),o=(e||n).getBoundingClientRect(),a=s.cloneNode(!0);a.classList.add("fly-item"),a.style.left=`${i.left}px`,a.style.top=`${i.top}px`,document.body.appendChild(a),requestAnimationFrame(()=>{const l=o.left-i.left+(o.width/2-14),c=o.top-i.top+(o.height/2-14);a.style.transform=`translate(${l}px, ${c}px) scale(0.6)`,a.style.opacity="0"}),setTimeout(()=>a.remove(),600)}catch{}},spawnXpFloat(t,e){try{const n=t.getBoundingClientRect(),s=document.createElement("div");s.className="xp-float",s.textContent=e,s.style.left=`${n.left+n.width/2-20}px`,s.style.top=`${n.top+10}px`,document.body.appendChild(s),setTimeout(()=>s.remove(),1e3)}catch{}},createGroundItem(t,e={}){var g;if(!t||!t.name||t.name==="Unknown"||typeof t.name!="string"||t.name.trim()===""){console.warn("Attempted to create ground item with invalid name:",t);return}const n=e||{},s=document.getElementById("discoveries")||document.querySelector(".game-content")||document.querySelector(".content-panel.active")||document.getElementById("game");if(!s)return;const i=document.createElement("div");i.className="ground-item";const o=`ground-${Date.now()}-${Math.floor(Math.random()*1e6)}`;i.dataset.cardId=o,i.dataset.itemName=t.name,i.dataset.itemType=t.type||"",i.dataset.itemCount=t.count||1,i.dataset.category=t.category||"ground",t.subtype&&(i.dataset.subtype=t.subtype);const a=t.count||(typeof n.qty=="number"?n.qty:Math.random()<.2?2:1),l=t.icon||this.getItemIcon(t),c=a>1?`${t.name} (x${a})`:t.name;i.innerHTML=`
      <div class="disc-icon">
        <svg aria-hidden="true"><use href="#${l}" xlink:href="#${l}"/></svg>
      </div>
      <div class="discovery-title">${c}</div>
    `,i.draggable=!0,s.appendChild(i);const h=s.getBoundingClientRect(),p=(g=document.getElementById("exploreBtn"))==null?void 0:g.getBoundingClientRect(),f=p?p.left+p.width/2:h.left+h.width/2,m=p?p.top+p.height/2:h.top+h.height/2;let b=f,S=m;n.spawnAtClient&&typeof n.spawnAtClient.x=="number"&&typeof n.spawnAtClient.y=="number"&&(b=n.spawnAtClient.x,S=n.spawnAtClient.y);const d=(i.offsetWidth||56)/2,u=(E,y)=>({x:E-h.left-d,y:y-h.top-d});if(n.spawnAtClient)(()=>{const k=i.offsetWidth||56,_=i.offsetHeight||56,B=h.left+4+k/2,G=h.right-4-k/2,R=h.top+4+_/2,oe=h.bottom-4-_/2;b=Math.max(B,Math.min(G,b)),S=Math.max(R,Math.min(oe,S));const Y=u(b,S);i.style.left=`${Y.x}px`,i.style.top=`${Y.y}px`})();else{const E=Math.random()*Math.PI*2;let y=Math.cos(E)*(1.5+Math.random()*2),k=Math.sin(E)*(1.5+Math.random()*2);const _=.92,B=()=>{const Y=i.offsetWidth||56,ae=i.offsetHeight||56,me=h.left+4+Y/2,pe=h.right-4-Y/2,ge=h.top+4+ae/2,fe=h.bottom-4-ae/2;b=Math.max(me,Math.min(pe,b)),S=Math.max(ge,Math.min(fe,S));const re=u(b,S);i.style.left=`${re.x}px`,i.style.top=`${re.y}px`};B();let G=40;const R=()=>{y*=_,k*=_,b+=y*6,S+=k*6,B(),--G>0&&requestAnimationFrame(R)};requestAnimationFrame(R)}return this.addGroundItemHandlers(i,{...t,count:a},n),i},getItemIcon(t){var s;if((s=ee[t.name])!=null&&s.icon)return ee[t.name].icon;const e={Minnow:"fish-minnow",Trout:"fish-trout",Bass:"fish-bass",Salmon:"fish-salmon","Golden Carp":"fish-carp"};if(e[t.name])return e[t.name];const n={helmet:"icon-helmet",chest:"icon-chest-armor",gloves:"icon-gloves",pants:"icon-pants",shoes:"icon-boots",ring:"icon-ring",amulet:"icon-amulet"};return t.type&&n[t.type]?n[t.type]:"icon-bag"},addGroundItemHandlers(t,e,n={}){t.draggable=!0,t.style.cursor="grab";let s=!1;const i=o=>{s||(o.preventDefault(),this.collectGroundItem(t,e,n))};t.addEventListener("dragstart",o=>{s=!0,o.clientX,o.clientY;const a=t.getBoundingClientRect();a.left,a.top,t.style.cursor="grabbing",t.classList.add("dragging"),o.dataTransfer.setData("text/ground-item",t.dataset.cardId),o.dataTransfer.effectAllowed="move",v.playPickup()}),t.addEventListener("dragend",o=>{t.style.cursor="grab",t.classList.remove("dragging"),setTimeout(()=>{s=!1},100)}),t.addEventListener("click",i)},collectGroundItem(t,e,n={}){if(e.category==="location"&&e.unlockLocationKey){const s=e.unlockLocationKey,i=document.querySelector(`#locationMenu [data-key="${s}"]`);i&&i.style.display==="none"&&(i.style.display="");const o=document.getElementById("status");o&&(o.textContent=`You discovered ${e.name}!`),v.playClick(),this.gainXP(e.xp||10)}else if(e.category==="treasure"){const s=5+Math.floor(Math.random()*20);for(let a=0;a<s;a++)P.addItem("Small Coin");const i=["Sea Shell","Driftwood","Seaweed"],o=i[Math.floor(Math.random()*i.length)];P.addItem(o),this.animateToInventory(t),v.playGoldPickup(),this.spawnXpFloat(t,`+${e.xp||12} XP`),this.gainXP(e.xp||12)}else{const s=e.count||1;for(let i=0;i<s;i++)P.addItem(e.name,e.type||null);this.animateToInventory(t),v.playPickupFor({name:e.name,category:e.category||"ground",subtype:e.subtype}),!n.noXp&&e.category&&e.category!=="ground"&&(r.foraging.xp+=(e.xp||5)*s,r.foraging.xp>=r.foraging.xpToNext&&(r.foraging.xp-=r.foraging.xpToNext,r.foraging.level++,r.foraging.xpToNext=Math.floor(r.foraging.xpToNext*1.2)),this.spawnXpFloat(t,`+${(e.xp||5)*s} XP`))}t.remove(),e.category&&e.category!=="ground"&&this.handleDiscovery(e),w.debouncedSave(),r.isExploring&&this.continue()},handleDiscovery(t){const e=new Date().toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit"});r.discoveries.unshift({...t,timestamp:e}),r.discoveries.length>10&&r.discoveries.pop();try{F(async()=>{const{SaveManager:s}=await Promise.resolve().then(()=>Z);return{SaveManager:s}},void 0).then(({SaveManager:s})=>{s.debouncedSave()})}catch{}const n=document.getElementById("status");if(t.type==="resource"&&n&&(n.textContent=`Found ${t.name}!`),this.gainXP(t.xp),r.exploration.level>=5&&Math.random()<.01){const i=document.querySelector('#locationMenu [data-key="forest"]');if(i&&i.style.display==="none"){i.style.display="";const o=document.getElementById("status");o&&(o.textContent="You discovered Whispering Woods!")}}},gainXP(t){for(r.exploration.xp+=t;r.exploration.xp>=r.exploration.xpToNext;)r.exploration.xp-=r.exploration.xpToNext,r.exploration.level++,r.exploration.xpToNext=Math.floor(r.exploration.xpToNext*1.25);const e=document.querySelector('[data-skill-level="exploration"]');e&&(e.textContent=r.exploration.level);const n=document.querySelector('.skill-card[data-skill="exploration"]');n&&n.style.setProperty("--progress-pct",`${Math.min(100,r.exploration.xp/r.exploration.xpToNext*100)}%`)}},We=Object.freeze(Object.defineProperty({__proto__:null,Exploration:z},Symbol.toStringTag,{value:"Module"})),H={};class Ye{constructor({url:e,name:n=null}={}){this.url=e||this._getWebSocketUrl(),this.name=n||localStorage.getItem("playerName")||`Adventurer-${Math.random().toString(36).slice(2,6)}`,this.ws=null,this.listeners=new Set,this.statusListeners=new Set,this._reconnectTimer=null}_getWebSocketUrl(){const e=location.hostname||"localhost";return e.includes("ngrok-free.app")||e.includes("ngrok.app")?`${location.protocol==="https:"?"wss:":"ws:"}//${e}/ws`:e==="localhost"||e==="127.0.0.1"?`ws://localhost:${(H==null?void 0:H.VITE_CHAT_PORT)||3001}`:`ws://${e}:${(H==null?void 0:H.VITE_CHAT_PORT)||3001}`}connect(){var e,n;try{(n=(e=this.ws)==null?void 0:e.close)==null||n.call(e)}catch{}console.log("Connecting to chat server at:",this.url),this.ws=new WebSocket(this.url),this.ws.addEventListener("open",()=>{console.log("Chat WebSocket connected");try{this.name=localStorage.getItem("playerName")||this.name}catch{}console.log("Sending hello message with name:",this.name),this._send({type:"hello",name:this.name}),this._emitStatus("online"),setTimeout(()=>{console.log("Requesting player list"),this._send({type:"requestPlayers"})},200)}),this.ws.addEventListener("message",s=>{try{const i=JSON.parse(s.data);console.log("Chat message received:",i),this.listeners.forEach(o=>o(i))}catch(i){console.error("Error parsing chat message:",i)}}),this.ws.addEventListener("close",s=>{console.log("Chat WebSocket closed:",s.code,s.reason),this._emitStatus("offline"),this._scheduleReconnect()}),this.ws.addEventListener("error",s=>{console.error("Chat WebSocket error:",s),this._emitStatus("offline");try{this.ws.close()}catch{}})}onMessage(e){return this.listeners.add(e),()=>this.listeners.delete(e)}onStatus(e){return this.statusListeners.add(e),()=>this.statusListeners.delete(e)}sendChat(e){!e||typeof e!="string"||(console.log("Sending chat message:",e),this._send({type:"chat",text:e}))}_send(e){try{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const n=JSON.stringify(e);console.log("Sending WebSocket message:",n),this.ws.send(n)}else console.warn("WebSocket not ready, cannot send:",e)}catch(n){console.error("Error sending WebSocket message:",n)}}_emitStatus(e){try{this.statusListeners.forEach(n=>n(e))}catch{}}_scheduleReconnect(){this._reconnectTimer||(this._reconnectTimer=setTimeout(()=>{this._reconnectTimer=null,this.connect()},1500))}}const M={elements:{},init(){var n;this.elements={navTabs:j(".nav-tab"),contentPanels:j(".content-panel"),hpBar:A("hp-bar"),staminaBar:A("stamina-bar"),manaBar:A("mana-bar"),fishingLevel:A("fishing-level-display"),expDisplay:A("exp-display"),expNeeded:A("exp-needed-display"),explorationProgress:A("exploration-progress"),invGrid:A("inv-grid"),fishBtn:A("fishBtn"),exploreBtn:A("exploreBtn"),explorationStatus:A("exploration-status"),gameLog:A("game-log"),status:A("status"),clock:A("clock"),saveBtn:A("saveBtn"),exitBtn:A("exitBtn"),themeToggleBtn:A("themeToggleBtn"),audioToggleBtn:A("audioToggleBtn"),ambienceVolume:A("ambienceVolume"),sfxVolume:A("sfxVolume"),settingsBtn:A("settingsBtn"),settingsPanel:A("settingsPanel")},this.setupNavigation(),this.setupButtons(),this.loadTheme(),(n=this.updateAudioToggleUI)==null||n.call(this),this.updateAll();const t=this.elements.exploreBtn;t&&(t.classList.remove("exploring","active"),t.setAttribute("aria-pressed","false"));const e=document.getElementById("exploreBtnLabel");e&&(e.textContent="Explore"),this.bindResetAccount();try{z.attachGroundDropHandlers()}catch{}},showLogin(){var c,h,p;const t=document.getElementById("authModal");if(t){t.hidden=!1;return}const e=document.createElement("div");e.id="authModal",e.className="auth-modal",e.innerHTML=`
      <div class="auth-dialog" role="dialog" aria-modal="true">
        <h2>Sign In</h2>
        <div class="auth-row"><input id="authUser" type="text" placeholder="Username" autocomplete="username"/></div>
        <div class="auth-row"><input id="authPass" type="password" placeholder="Password" autocomplete="current-password"/></div>
        <div class="auth-actions">
          <button id="authLogin" class="primary-btn">Login</button>
          <button id="authRegister" class="primary-btn">Register</button>
          <button id="authClose" class="header-btn">Close</button>
        </div>
        <div id="authStatus" class="auth-status"></div>
      </div>`,document.body.appendChild(e);const n=e.querySelector("#authStatus"),s=f=>{n&&(n.textContent=f)},i=()=>{var f,m,b;return{username:(m=(f=e.querySelector("#authUser"))==null?void 0:f.value)==null?void 0:m.trim(),password:((b=e.querySelector("#authPass"))==null?void 0:b.value)||""}},o=async(f,m)=>{const b=window.location.hostname;return(await fetch(`http://${b}:3002${f}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).json()},a=async()=>{const f=i();if(!f.username||!f.password)return s("Enter username and password");s("Signing in...");try{const m=await o("/api/login",f);m!=null&&m.token?(localStorage.setItem("authToken",m.token),s("Signed in"),e.hidden=!0):s((m==null?void 0:m.error)||"Login failed")}catch{s("Login failed")}},l=async()=>{const f=i();if(!f.username||!f.password)return s("Enter username and password");s("Registering...");try{const m=await o("/api/register",f);m!=null&&m.token?(localStorage.setItem("authToken",m.token),s("Registered and signed in"),e.hidden=!0):s((m==null?void 0:m.error)||"Registration failed")}catch{s("Registration failed")}};(c=e.querySelector("#authLogin"))==null||c.addEventListener("click",a),(h=e.querySelector("#authRegister"))==null||h.addEventListener("click",l),(p=e.querySelector("#authClose"))==null||p.addEventListener("click",()=>{e.hidden=!0})},setupSaveSlots(){const t=document.getElementById("save-slots");if(!t)return;const e=()=>{w.listSlots().forEach(s=>{const i=t.querySelector(`.save-slot[data-slot="${s.key}"]`);if(!i)return;const o=i.querySelector(".slot-actions"),a=i.querySelector(".slot-meta");s.hasData?(i.classList.remove("empty"),a&&(a.textContent=`Saved: ${new Date(s.savedAt||Date.now()).toLocaleString()}`),o.innerHTML=`
            <button class="primary-btn save-btn" data-act="save">Save</button>
            <button class="primary-btn load-btn" data-act="load">Load</button>
            <button class="primary-btn delete-btn" data-act="delete">Delete</button>
          `):(i.classList.add("empty"),a&&(a.textContent=""),o.innerHTML='<button class="primary-btn new-btn" data-act="new" style="width:100%">New Game</button>')})};e(),t.addEventListener("click",n=>{const s=n.target&&n.target.closest&&n.target.closest("button[data-act]");if(!s)return;const i=s.closest(".save-slot");if(!i)return;const o=i.getAttribute("data-slot"),a=s.getAttribute("data-act");a==="save"?(w.saveToSlot(o),this.setStatus(`Saved to ${o}`),e()):a==="load"?w.loadFromSlot(o)||this.setStatus("No save data to load"):a==="delete"?confirm(`Delete ${o}?`)&&(w.deleteSlot(o),this.setStatus(`Deleted ${o}`),e()):a==="new"&&confirm(`Start new game in ${o}?`)&&w.newGame(o)})},toggleTheme(){const e=(document.body.getAttribute("data-theme")||"light")==="dark"?"light":"dark";document.body.setAttribute("data-theme",e),localStorage.setItem("gameTheme",e);try{F(async()=>{const{SaveManager:n}=await Promise.resolve().then(()=>Z);return{SaveManager:n}},void 0).then(({SaveManager:n})=>{n.debouncedSave()})}catch{}this.elements.themeToggleBtn&&(this.elements.themeToggleBtn.title=e==="dark"?"Switch to Light Theme":"Switch to Dark Theme")},setupNavigation(){this.elements.navTabs.forEach(c=>{c.addEventListener("click",()=>{const h=c.dataset.view;this.switchView(h),v.playButtonClick()}),c.addEventListener("mouseenter",()=>v.playButtonHover()),c.addEventListener("keydown",h=>{(h.key==="Enter"||h.key===" ")&&v.playButtonClick()})});const t=document.getElementById("locationName"),e=document.getElementById("locationBadge"),n=document.getElementById("locationMenu"),s=document.getElementById("locationIcon");document.getElementById("locationBackground");const i=e==null?void 0:e.querySelector(".caret"),o=document.documentElement.style;t&&(t.textContent=V.current.name),s&&(s.textContent=V.current.icon),e&&(e.className=`location-badge ${V.current.key}`),this.applyPanelBackground();const a=c=>{!e||!n||(e.setAttribute("aria-expanded",c?"true":"false"),n.classList.toggle("open",!!c))},l=()=>{v.playClick()};e&&e.addEventListener("click",c=>{const h=c.target;if(h&&h.classList&&h.classList.contains("caret")){const p=e.getAttribute("aria-expanded")==="true";a(!p),c.stopPropagation();return}a(!1),l()}),i&&i.addEventListener("click",c=>{const h=e.getAttribute("aria-expanded")==="true";a(!h),c.stopPropagation()}),document.addEventListener("click",c=>{!e||!n||!e.contains(c.target)&&!n.contains(c.target)&&a(!1)}),e&&e.addEventListener("keydown",c=>{c.key==="ArrowDown"?(a(!0),c.preventDefault()):(c.key==="Enter"||c.key===" ")&&(a(!1),l(),c.preventDefault())}),n&&n.querySelectorAll('li[role="option"]').forEach(c=>{c.addEventListener("click",()=>{const h=c.dataset.key,p=V.all[h];p&&(V.current={key:p.key,name:p.name,icon:p.icon},t&&(t.textContent=p.name),s&&(s.textContent=p.icon),e&&(e.className=`location-badge ${p.badgeClass}`),this.applyPanelBackground(),p.key==="beach"?o.setProperty("--focus-glow-color","#5aa9d6"):p.key==="forest"&&o.setProperty("--focus-glow-color","#406b40"),n.querySelectorAll("li").forEach(f=>f.classList.toggle("active",f===c)),a(!1),l())})})},switchView(t){r.activeView=t,this.elements.navTabs.forEach(e=>e.classList.toggle("active",e.dataset.view===t)),this.elements.contentPanels.forEach(e=>e.classList.toggle("active",e.dataset.screen===t)),t==="character"&&requestAnimationFrame(()=>this.sizeInventoryGrid()),this.applyPanelBackground();try{F(()=>Promise.resolve().then(()=>We),void 0).then(e=>e.Exploration.attachGroundDropHandlers())}catch{}},applyPanelBackground(){var i,o;const t=document.querySelector(".content-panel.active"),e=document.querySelector(".game-content");if(!t&&!e)return;const n=((o=(i=window.Locations)==null?void 0:i.current)==null?void 0:o.key)||"beach",s=["beach-vector","forest-vector","mountain-vector","desert-vector"];t&&(t.classList.remove(...s),n==="beach"?t.classList.add("beach-vector"):n==="forest"?t.classList.add("forest-vector"):n==="mountain"?t.classList.add("mountain-vector"):n==="desert"&&t.classList.add("desert-vector")),e&&(e.classList.remove(...s),n==="beach"?e.classList.add("beach-vector"):n==="forest"?e.classList.add("forest-vector"):n==="mountain"?e.classList.add("mountain-vector"):n==="desert"&&e.classList.add("desert-vector"));try{const a=document.documentElement,l=(c,h)=>{let p=0;const f=new Image,m=()=>{if(p>=h.length)return;const b=h[p++];f.onload=()=>{a.style.setProperty(c,`url('${b}')`)},f.onerror=m,f.src=b};m()};l("--beach-bg-url",["/assets/beach-background.png","/assets/beach-background.jpg"]),l("--beach-bg-url-dark",["/assets/beach-background-dark.png","/assets/beach-background-dark.jpg"]),l("--forest-bg-url",["/assets/forest-background.png","/assets/forest-background.jpg"]),l("--mountain-bg-url",["/assets/mountain-background.png","/assets/mountain-background.jpg"]),l("--desert-bg-url",["/assets/desert-background.png","/assets/desert-background.jpg"])}catch{}},setupButtons(){this.elements.fishBtn&&this.elements.fishBtn.addEventListener("click",()=>{v.playButtonClick(),he.start()}),this.elements.exploreBtn&&this.elements.exploreBtn.addEventListener("click",d=>{var u,g;try{v.startAmbientSounds()}catch{}(g=(u=d.currentTarget)==null?void 0:u.blur)==null||g.call(u),r.isExploring?(v.playButtonClick(),z.stop()):(v.playButtonClick(),z.start())});const t=document.getElementById("collectAllBtn");t&&t.addEventListener("click",()=>{v.playButtonClick(),this.collectAllGroundItems()}),this.elements.exitBtn&&this.elements.exitBtn.addEventListener("click",async()=>{v.playButtonClick();try{const{SaveManager:d}=await F(async()=>{const{SaveManager:u}=await Promise.resolve().then(()=>Z);return{SaveManager:u}},void 0);await d.saveNow(),console.log("Game saved successfully before logout")}catch(d){console.error("Failed to save before logout:",d)}try{localStorage.removeItem("authToken")}catch{}try{localStorage.removeItem("playerName")}catch{}window.location.reload()}),this.elements.themeToggleBtn&&this.elements.themeToggleBtn.addEventListener("click",()=>{v.playButtonClick(),this.toggleTheme()}),this.elements.audioToggleBtn&&this.elements.audioToggleBtn.addEventListener("click",async()=>{var u,g;v.playButtonClick();try{await((g=(u=v.ensureContext())==null?void 0:u.resume)==null?void 0:g.call(u))}catch{}v.toggleAmbientSounds();const d=!v.ambientEnabled;this.elements.audioToggleBtn.classList.toggle("muted",d),this.elements.audioToggleBtn.title=d?"Unmute Audio":"Mute Audio",this.elements.audioToggleBtn.setAttribute("aria-pressed",String(d))}),this.elements.ambienceVolume&&this.elements.ambienceVolume.addEventListener("input",d=>{const u=parseInt(d.target.value)/100;v.setAmbientVolume(u)}),this.elements.sfxVolume&&this.elements.sfxVolume.addEventListener("input",d=>{const u=parseInt(d.target.value)/100;v.setSfxVolume(u)});const e=document.getElementById("toggleZones"),n=document.getElementById("panel-zones"),s=document.getElementById("toggleEquipment"),i=document.getElementById("toggleInventory"),o=document.getElementById("toggleSkills"),a=document.getElementById("toggleChat"),l=document.getElementById("panel-equipment"),c=document.getElementById("panel-inventory"),h=document.getElementById("panel-skills"),p=document.getElementById("panel-chat"),f=d=>d&&d.style.display!=="none",m=(d,u)=>{if(!d||!u)return;const g=f(u);d.classList.toggle("active",g),d.setAttribute("aria-pressed",String(g))},b=d=>{var g,E;if(!d)return;const u=f(d);if(d.style.display=u?"none":"block",!u)try{(E=(g=d.querySelector(".drag-handle"))==null?void 0:g.focus)==null||E.call(g)}catch{}};if(e&&e.addEventListener("click",d=>{var u,g;if((g=(u=d.currentTarget)==null?void 0:u.blur)==null||g.call(u),v.playButtonClick(),b(n),m(e,n),n&&n.style.display!=="none")try{F(async()=>{const{SkillingZones:E}=await import("./index-CHEN7uld.js");return{SkillingZones:E}},[]).then(({SkillingZones:E})=>E.renderAllInPanel())}catch{}}),s&&s.addEventListener("click",d=>{var u,g;(g=(u=d.currentTarget)==null?void 0:u.blur)==null||g.call(u),v.playButtonClick(),b(l),m(s,l)}),i&&i.addEventListener("click",d=>{var u,g;(g=(u=d.currentTarget)==null?void 0:u.blur)==null||g.call(u),v.playButtonClick(),b(c),m(i,c)}),o&&o.addEventListener("click",d=>{var u,g;(g=(u=d.currentTarget)==null?void 0:u.blur)==null||g.call(u),v.playButtonClick(),b(h),m(o,h)}),a&&a.addEventListener("click",d=>{var u,g,E,y;if((g=(u=d.currentTarget)==null?void 0:u.blur)==null||g.call(u),v.playButtonClick(),b(p),m(a,p),p&&p.style.display!=="none"){try{(y=(E=document.getElementById("chat-input"))==null?void 0:E.focus)==null||y.call(E),window.globalChat&&window.globalChat.ws&&window.globalChat.ws.readyState===1&&(console.log("Requesting fresh player list on chat panel open"),window.globalChat._send({type:"requestPlayers"}))}catch{}this.resetChatUnreadCount?this.resetChatUnreadCount():a.classList.remove("has-notification")}}),m(e,n),m(s,l),m(i,c),m(o,h),m(a,p),(()=>{document.querySelectorAll(".draggable-panel").forEach(d=>{const u=d.querySelector(".drag-handle");u&&u.addEventListener("click",g=>{const E=u.getBoundingClientRect(),y=g.clientX-E.left;g.clientY-E.top,y>E.width-40&&window.innerWidth<=768&&(d.style.display="none",d.id==="panel-zones"&&m(e,d),d.id==="panel-equipment"&&m(s,d),d.id==="panel-inventory"&&m(i,d),d.id==="panel-skills"&&m(o,d),d.id==="panel-chat"&&(m(a,d),this.resetChatUnreadCount?this.resetChatUnreadCount():a==null||a.classList.remove("has-notification")))})})})(),document.addEventListener("keydown",d=>{if(d.key!=="Escape")return;const u=document.getElementById("desktop-panels");if(!u)return;const g=Array.from(u.querySelectorAll(".draggable-panel")).filter(y=>y.style.display!=="none");if(g.length===0)return;const E=g[g.length-1];E.style.display="none",E.id==="panel-equipment"&&m(s,E),E.id==="panel-inventory"&&m(i,E),E.id==="panel-skills"&&m(o,E),E.id==="panel-chat"&&(m(a,E),this.resetChatUnreadCount?this.resetChatUnreadCount():a==null||a.classList.remove("has-notification"))}),this.elements.settingsBtn&&this.elements.settingsPanel){const d=this.elements.settingsBtn,u=this.elements.settingsPanel,g=y=>{y?(u.hidden=!1,d.setAttribute("aria-expanded","true")):(u.hidden=!0,d.setAttribute("aria-expanded","false"))};let E=!1;d.addEventListener("click",y=>{y.stopPropagation(),E=!E,g(E)}),document.addEventListener("click",y=>{E&&!u.contains(y.target)&&y.target!==d&&(E=!1,g(!1))})}try{const d=document.getElementById("ground-trash");d&&d.addEventListener("click",()=>{var g;try{v.playDelete()}catch{(g=v.playButtonClick)==null||g.call(v)}const u=document.getElementById("discoveries")||document.querySelector(".game-content");u&&u.querySelectorAll(".ground-item, .discovery-card").forEach(E=>E.remove())})}catch{}},bindResetAccount(){const t=document.getElementById("resetAccountBtn");t&&t.addEventListener("click",async()=>{var s,i,o;(s=v.playButtonClick)==null||s.call(v);const e=document.createElement("div");e.className="auth-modal",e.innerHTML=`
        <div class="auth-dialog" role="dialog" aria-modal="true">
          <h3>Reset Account</h3>
          <p style="font-size:12px;margin:8px 0;">This will erase your account save data. This cannot be undone.</p>
          <div class="auth-actions">
            <button id="ra-confirm" class="primary-btn">Confirm</button>
            <button id="ra-cancel" class="header-btn">Cancel</button>
          </div>
        </div>`,document.body.appendChild(e);const n=()=>e.remove();(i=e.querySelector("#ra-cancel"))==null||i.addEventListener("click",n),(o=e.querySelector("#ra-confirm"))==null||o.addEventListener("click",async()=>{try{const l=localStorage.getItem("authToken");if(l){const c=window.location.hostname;(await fetch(`http://${c}:3002/api/account`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok||console.error("Failed to delete account from server")}}catch(l){console.error("Error deleting account:",l)}try{localStorage.removeItem("sandboxIdleState")}catch{}try{localStorage.removeItem("fish_discovered")}catch{}try{localStorage.removeItem("authToken")}catch{}try{localStorage.removeItem("playerName")}catch{}n();const a=document.getElementById("status");a&&(a.textContent="Account deleted successfully"),setTimeout(()=>window.location.reload(),1e3)})})},collectAllGroundItems(){const t=document.getElementById("discoveries")||document.querySelector(".game-content");if(!t)return;const e=t.querySelectorAll(".ground-item");if(e.length===0){const i=document.getElementById("status");i&&(i.textContent="No ground items to collect");return}let n=0;const s=document.getElementById("collectAllBtn");if(s&&(s.classList.add("collecting"),setTimeout(()=>{s.classList.remove("collecting")},600)),e.forEach(i=>{const o=i.dataset.itemName,a=i.dataset.itemType||null,l=parseInt(i.dataset.itemCount)||1;if(o&&o!=="Unknown"){for(let c=0;c<l;c++)P.addItem(o,a);n+=l,i.remove()}}),n>0){const i=document.getElementById("status");i&&(i.textContent=`Collected ${n} item${n>1?"s":""}`),v.playPickupFor({name:"items",category:"ground"}),w.debouncedSave()}},initChat(){if(this.chatInitialized){console.log("Chat already initialized, skipping...");return}const t=document.getElementById("toggleChat"),e=document.getElementById("panel-chat"),n=document.getElementById("chat-messages"),s=document.getElementById("chat-input"),i=document.getElementById("chat-send"),o=document.getElementById("togglePlayersBtn"),a=document.getElementById("chatSidebar"),l=document.querySelector(".players-count"),c=t==null?void 0:t.querySelector(".notification-badge");if(!n||!s||!i){console.warn("Chat UI elements not found");return}this.chatInitialized=!0,console.log("Initializing chat client...");let h=0;const p=()=>{!t||!c||(h>0?(t.classList.add("has-notification"),c.textContent=h>99?"99+":h.toString()):(t.classList.remove("has-notification"),c.textContent=""))},f=()=>{h=0,p()};this.resetChatUnreadCount=f;let m=!1;const b=()=>{m=!m,a&&(a.style.display=m?"block":"none"),o&&(o.classList.toggle("active",m),o.title=m?"Hide Online Players":"Show Online Players"),m&&window.globalChat&&window.globalChat.ws&&window.globalChat.ws.readyState===1&&(console.log("Requesting fresh player list on players panel open"),window.globalChat._send({type:"requestPlayers"}))};o&&o.addEventListener("click",y=>{y.stopPropagation(),b()});const S=y=>{t&&(t.classList.toggle("online",y==="online"),t.classList.toggle("offline",y!=="online"),t.title=y==="online"?"Global Chat (Online)":"Global Chat (Offline)")},d=y=>{const k=document.createElement("div");k.className=`chat-message ${y.type}`;const _=new Date(y.ts||Date.now()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(y.type==="system")k.innerHTML=`<span class="chat-time">${_}</span> <span class="chat-system">${y.text}</span>`;else if(y.type==="chat")k.innerHTML=`<span class="chat-time">${_}</span> <span class="chat-name">${y.name}</span>: <span class="chat-text">${y.text}</span>`;else if(y.type==="players"){u(y.players);return}if(n.appendChild(k),n.scrollTop=n.scrollHeight,t&&e){const B=e.style.display==="block",G=localStorage.getItem("playerName")||"",R=y.type==="chat"&&y.name&&y.name!==G;!B&&R&&(h++,p())}for(;n.children.length>100;)n.removeChild(n.firstChild)},u=y=>{const k=document.getElementById("online-players");if(!k)return;console.log("Updating players list:",y);const _=localStorage.getItem("playerName")||"";if(console.log("Current player name from localStorage:",_),l&&(l.textContent=y.length.toString()),k.innerHTML="",y.length===0){const B=document.createElement("div");B.className="player-item",B.textContent="No players online",B.style.fontStyle="italic",B.style.opacity="0.6",k.appendChild(B);return}y.forEach(B=>{const G=document.createElement("div");G.className="player-item";const R=B.name===_;R&&(G.classList.add("current-player"),console.log("Found current player:",B.name)),G.textContent=B.name,k.appendChild(G),console.log(`Added player: ${B.name} (current: ${R})`)})},g=()=>{const y=s.value.trim();y&&(E.sendChat(y),s.value="")};if(i.addEventListener("click",g),s.addEventListener("keydown",y=>{y.key==="Enter"&&(y.preventDefault(),g())}),window.globalChat){console.log("Cleaning up existing chat client...");try{window.globalChat.ws&&window.globalChat.ws.close(),window.globalChat=null}catch(y){console.log("Error cleaning up existing chat:",y)}}const E=new Ye({});E.onStatus(S),E.onMessage(d),E.connect(),S("offline"),window.globalChat=E,window.debugChat=()=>{var y,k;console.log("=== Chat Debug Info ==="),console.log("Current player name (localStorage):",localStorage.getItem("playerName")),console.log("Chat client name:",E.name),console.log("WebSocket state:",(y=E.ws)==null?void 0:y.readyState),console.log("Players count element:",l==null?void 0:l.textContent),console.log("Players container children:",(k=document.getElementById("online-players"))==null?void 0:k.children.length),console.log("========================")}},updateStats(){const{stats:t}=r;this.elements.hpBar&&(this.elements.hpBar.style.width=`${t.hp/t.hpMax*100}%`),this.elements.staminaBar&&(this.elements.staminaBar.style.width=`${t.stamina/t.staminaMax*100}%`),this.elements.manaBar&&(this.elements.manaBar.style.width=`${t.mana/t.manaMax*100}%`)},updateSkills(){const t=A("fishing-level-display");t&&(t.textContent=r.fishing.level);const e=A("exp-display");e&&(e.textContent=r.fishing.xp);const n=A("exp-needed-display");n&&(n.textContent=r.fishing.xpToNext);const s=Math.min(100,r.fishing.xp/r.fishing.xpToNext*100);document.querySelectorAll('.skill-card[data-skill="fishing"]').forEach(a=>{a.style.setProperty("--progress-pct",`${s}%`);try{const l=a.querySelector(".skill-icon-large svg");if(l){l.classList.add("fish-animated");const c=l.querySelector("use")||document.createElementNS("http://www.w3.org/2000/svg","use");c.parentNode||l.appendChild(c),c.setAttribute("href","#fish-koi")}}catch{}});const i=Math.min(100,r.foraging.xp/r.foraging.xpToNext*100);document.querySelectorAll('.skill-card[data-skill="foraging"]').forEach(a=>a.style.setProperty("--progress-pct",`${i}%`)),document.querySelectorAll('[data-skill-level="foraging"]').forEach(a=>{a.textContent=r.foraging.level});const o=Math.min(100,r.exploration.xp/r.exploration.xpToNext*100);document.querySelectorAll('.skill-card[data-skill="exploration"]').forEach(a=>a.style.setProperty("--progress-pct",`${o}%`)),document.querySelectorAll('[data-skill-level="exploration"]').forEach(a=>{a.textContent=r.exploration.level}),["attack","strength","defense"].forEach(a=>{const l=Math.min(100,r.combat[a].xp/r.combat[a].xpToNext*100);document.querySelectorAll(`.skill-card[data-skill="${a}"]`).forEach(c=>c.style.setProperty("--progress-pct",`${l}%`)),document.querySelectorAll(`[data-skill-level="${a}"]`).forEach(c=>{c.textContent=r.combat[a].level})}),document.querySelectorAll('[data-skill-level="fishing"]').forEach(a=>{a.textContent=r.fishing.level})},updateAll(){this.updateStats(),this.updateSkills(),this.updateClock()},updateClock(){if(!this.elements.clock)return;const t=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});this.elements.clock.textContent=t},setStatus(t){this.elements.status&&(this.elements.status.textContent=t)},addToLog(t){},saveGame(){try{localStorage.setItem("sandboxIdleState",JSON.stringify(r)),this.setStatus("Game saved!"),this.addToLog("Game saved successfully"),v.playClick()}catch(t){this.setStatus("Save failed"),console.error("Save failed:",t)}},sizeInventoryGrid(){const t=this.elements.invGrid;t&&(t.style.width="auto",t.style.height="auto")},loadTheme(){const t=localStorage.getItem("gameTheme")||"dark";document.body.setAttribute("data-theme",t),this.elements.themeToggleBtn&&(this.elements.themeToggleBtn.title=t==="dark"?"Switch to Light Theme":"Switch to Dark Theme")},updateAudioToggleUI(){}},de={panels:[{id:"panel-equipment",containerSelector:".game-content",defaultPos:{x:16,y:80}},{id:"panel-inventory",containerSelector:".game-content",defaultPos:{x:380,y:80}},{id:"panel-skills",containerSelector:".game-content",defaultPos:{x:720,y:80}},{id:"panel-zones",containerSelector:".game-content",defaultPos:{x:1080,y:80}},{id:"panel-chat",containerSelector:".game-content",defaultPos:{x:16,y:420}}],dragging:null,offsetX:0,offsetY:0,containerRect:null,zCounter:10,init(){this.panels.forEach(t=>this.setupPanel(t)),window.addEventListener("resize",()=>this.clampAll()),this.clampAll()},setupPanel({id:t,containerSelector:e,defaultPos:n}){const s=document.getElementById(t),i=document.querySelector(e);if(!s||!i)return;const o=`panel-pos:${t}`,a=localStorage.getItem(o);let l=a?JSON.parse(a):n;s.style.left=l.x+"px",s.style.top=l.y+"px";const c=s.querySelector(".drag-handle")||s,h=()=>{this.zCounter+=1,s.style.zIndex=String(this.zCounter)};c.addEventListener("mousedown",p=>{p.button===0&&(h(),this.startDrag(s,i,p))}),c.addEventListener("click",()=>h()),c.addEventListener("touchstart",p=>{const f=p.touches[0];this.startDrag(s,i,f),p.preventDefault()},{passive:!1})},startDrag(t,e,n){this.dragging=t,t.classList.add("dragging");const s=t.getBoundingClientRect();this.containerRect=e.getBoundingClientRect(),this.offsetX=n.clientX-s.left,this.offsetY=n.clientY-s.top;const i=a=>{const l=a.touches?a.touches[0]:a;this.onMove(l)},o=()=>this.endDrag(i,o);document.addEventListener("mousemove",i),document.addEventListener("mouseup",o,{once:!0}),document.addEventListener("touchmove",i,{passive:!1}),document.addEventListener("touchend",o,{once:!0})},onMove(t){if(!this.dragging)return;let e=t.clientX-this.containerRect.left-this.offsetX,n=t.clientY-this.containerRect.top-this.offsetY;const s=this.containerRect.width-this.dragging.offsetWidth,i=this.containerRect.height-this.dragging.offsetHeight;e=Math.max(0,Math.min(s,e)),n=Math.max(0,Math.min(i,n)),this.dragging.style.left=e+"px",this.dragging.style.top=n+"px"},endDrag(t,e){if(!this.dragging)return;const n=this.dragging;n.classList.remove("dragging"),document.removeEventListener("mousemove",t),document.removeEventListener("touchmove",t);const s={x:parseInt(n.style.left||"0",10),y:parseInt(n.style.top||"0",10)};localStorage.setItem(`panel-pos:${n.id}`,JSON.stringify(s));try{F(async()=>{const{SaveManager:i}=await Promise.resolve().then(()=>Z);return{SaveManager:i}},void 0).then(({SaveManager:i})=>{i.debouncedSave()})}catch{}this.dragging=null},clampAll(){this.panels.forEach(({id:t,containerSelector:e})=>{const n=document.getElementById(t),s=document.querySelector(e);if(!n||!s)return;const i=s.getBoundingClientRect(),o=Math.min(Math.max(0,parseInt(n.style.left||"0",10)),Math.max(0,i.width-n.offsetWidth)),a=Math.min(Math.max(0,parseInt(n.style.top||"0",10)),Math.max(0,i.height-n.offsetHeight));n.style.left=o+"px",n.style.top=a+"px"})}},je={fishing:{name:"Fishing",description:"Improves fishing speed and rare fish chances"},foraging:{name:"Foraging",description:"Finding useful resources in the wild"},exploration:{name:"Exploration",description:"Increases discovery chances and reduces exploration time"},attack:{name:"Attack",description:"Increases chance to hit in combat"},strength:{name:"Strength",description:"Increases melee damage"},defense:{name:"Defense",description:"Reduces damage taken from enemies"}},ue={init(){document.querySelectorAll(".skill-card").forEach(t=>{var i,o,a;const e=t.getAttribute("data-skill");t.addEventListener("mouseenter",l=>{var f;const c=je[e];if(!c)return;const h=((f=r.combat)==null?void 0:f[e])||r[e];if(!h)return;const p=`${c.name}
Level ${h.level}
${h.xp} / ${h.xpToNext} XP

${c.description}`;N.show(l,p)}),t.addEventListener("mouseleave",()=>N.hide()),t.addEventListener("mousemove",l=>N.move(l)),t.addEventListener("mousedown",()=>N.hide());const n=(()=>{var l;return(l=r.combat)!=null&&l[e]?Math.min(100,r.combat[e].xp/r.combat[e].xpToNext*100):r[e]?Math.min(100,r[e].xp/r[e].xpToNext*100):0})();t.style.setProperty("--progress-pct",`${n}%`);const s=document.querySelector(`[data-skill-level="${e}"]`);if(s){const l=((o=(i=r.combat)==null?void 0:i[e])==null?void 0:o.level)??((a=r[e])==null?void 0:a.level)??1;s.textContent=l}})}};function Je(){L.initialize(),I.info("Error handler initialized"),qe()||I.error("Configuration validation failed - game may not work correctly"),I.info("Starting game initialization..."),Ne().then(()=>{var e,n;I.debug("Initializing UI systems..."),M.init();try{(e=M.initChat)==null||e.call(M)}catch{}I.debug("Initializing inventory system..."),P.init(),se(P),I.debug("Initializing equipment system..."),D.init(),I.debug("Initializing fishing system..."),he.init(),I.debug("Initializing panel management..."),de.init(),I.debug("Initializing skills system..."),ue.init(),I.debug("Starting save manager...");try{(n=w.startAutoSave)==null||n.call(w)}catch{}I.debug("Loading audio assets...");try{v.loadGoldPickupSound()}catch{}I.debug("Rendering initial UI..."),P.render(),D.updateUI(),M.updateAll();try{z.stop()}catch{}I.debug("Initializing idle manager...");try{O.init()}catch{}try{JSON.parse(localStorage.getItem("fish_discovered")||"[]").length===0&&(localStorage.setItem("fish_discovered",JSON.stringify(["Minnow"])),I.debug("Initialized Minnow as discovered for new player"))}catch(s){I.error("Failed to initialize fish discoveries",s)}I.info("Game initialization complete!");try{const s=()=>{try{w.saveNow(),I.info("Complete game data saved on exit")}catch(i){I.error("Failed to save on exit",i)}};window.addEventListener("beforeunload",i=>(s(),i.preventDefault(),i.returnValue="Your game progress will be saved automatically.",i.returnValue)),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&s()}),window.addEventListener("blur",()=>{s()})}catch(s){I.error("Failed to setup auto-save handlers",s)}setInterval(()=>{r.stats.stamina=Math.min(r.stats.staminaMax,r.stats.stamina+.5),r.stats.mana=Math.min(r.stats.manaMax,r.stats.mana+.3),M.updateStats(),w.debouncedSave()},1e3),setInterval(()=>M.updateClock(),1e3);const t=s=>{v.startAmbientSounds(),document.removeEventListener("pointerdown",t),document.removeEventListener("keydown",t)};document.addEventListener("pointerdown",t,{once:!0}),document.addEventListener("keydown",t)}).catch(t=>{var e,n;L.handleError(t,{component:"main",operation:"loadSavedState"}),M.init();try{(e=M.initChat)==null||e.call(M)}catch{}P.init(),se(P),D.init(),de.init(),ue.init();try{(n=w.startAutoSave)==null||n.call(w)}catch{}try{v.loadGoldPickupSound()}catch{}P.render(),D.updateUI(),M.updateAll();try{z.stop()}catch{}try{O.init()}catch{}try{JSON.parse(localStorage.getItem("fish_discovered")||"[]").length===0&&(localStorage.setItem("fish_discovered",JSON.stringify(["Minnow"])),I.debug("Initialized Minnow as discovered for new player (fallback)"))}catch(s){I.error("Failed to initialize fish discoveries (fallback)",s)}})}function Ke(){var h,p,f,m,b;const t=localStorage.getItem("gameTheme")||"dark";if(document.body.setAttribute("data-theme",t),localStorage.getItem("authToken"))return Je();const n=document.getElementById("login-screen");if(!n)return;n.hidden=!1,document.body.classList.add("login-mode");const s=document.getElementById("ls-status"),i=S=>{s&&(s.textContent=S)},o=()=>{var S,d,u;return{username:(d=(S=document.getElementById("ls-username"))==null?void 0:S.value)==null?void 0:d.trim(),password:((u=document.getElementById("ls-password"))==null?void 0:u.value)||""}},a=async(S,d)=>{const u=window.location.hostname;let g;return u.includes("ngrok-free.app")||u.includes("ngrok.app")?g=window.location.origin:g=`http://${u}:3002`,(await fetch(`${g}${S}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).json()},l=async()=>{const S=o();if(!S.username||!S.password)return i("Enter username and password");i("Signing in...");try{const d=await a("/api/login",S);d!=null&&d.token?(localStorage.setItem("authToken",d.token),localStorage.setItem("playerName",S.username),i("Welcome back! Loading your game..."),setTimeout(()=>window.location.reload(),500)):i((d==null?void 0:d.error)||"Login failed")}catch{i("Connection failed - check if servers are running")}},c=async()=>{const S=o();if(!S.username||!S.password)return i("Enter username and password");i("Creating account...");try{const d=await a("/api/register",S);d!=null&&d.token?(localStorage.setItem("authToken",d.token),localStorage.setItem("playerName",S.username),i("Account created! Starting your adventure..."),setTimeout(()=>window.location.reload(),500)):i((d==null?void 0:d.error)||"Registration failed")}catch{i("Connection failed - check if servers are running")}};(h=document.getElementById("ls-login"))==null||h.addEventListener("click",l),(p=document.getElementById("ls-register"))==null||p.addEventListener("click",c),(f=document.getElementById("ls-password"))==null||f.addEventListener("keydown",S=>{S.key==="Enter"&&l()}),(m=document.getElementById("loginThemeToggle"))==null||m.addEventListener("click",()=>{const d=(document.body.getAttribute("data-theme")||"dark")==="dark"?"light":"dark";document.body.setAttribute("data-theme",d),localStorage.setItem("gameTheme",d)}),(b=document.getElementById("loginMuteToggle"))==null||b.addEventListener("click",S=>{const d=S.target.closest("button"),u=d.querySelector("svg use");d.classList.contains("muted")?(d.classList.remove("muted"),d.title="Mute Music",u.setAttribute("href","#icon-volume")):(d.classList.add("muted"),d.title="Unmute Music",u.setAttribute("href","#icon-volume-mute"))})}document.addEventListener("DOMContentLoaded",Ke);export{v as A,he as F,O as I,V as L,Z as S,F as _,et as a,P as b,r as g};
